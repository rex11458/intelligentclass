webpackJsonp([32],{"/EMt":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=a("mvHQ"),i=a.n(n),o=(a("WJbf"),a("OhwO")),c=a("bOdI"),r=a.n(c),u=(a("mMXg"),a("qYlo")),l=(a("3Lne"),a("SSsa")),h=a("bBUo"),d=a("1wEQ"),g=a("XhFK"),f=a.n(g),p=a("FwVa"),v=a("j/ZV"),m={name:"",components:(s={headTop:h.a,RImage:d.a},r()(s,l.a.name,l.a),r()(s,u.a.name,u.a),s),props:{},data:function(){return{score:0,total:0,good:0,dataList:[],contentType:p.b.Text,contentTypeDefault:p.b.Text,content:"",imgBase:"",defaultPhotoImg:f.a,groupName:this.$store.getters.group&&this.$store.getters.group.groupName||"暂无组名",showEdit:!1,imagePreview:null}},created:function(){this.getDataStatics(),this.getDataDetail()},mounted:function(){var t=this;this.$nextTick(function(){window.uploadImage=function(e){t.afterRead(e)}})},methods:{preview:function(t){this.imagePreview=Object(o.a)({images:[t],showIndex:!1,onClose:function(){}})},getDataStatics:function(){var t=this;this.$gatewayHttp.groupDiscussion.getStatistic({groupID:this.$store.getters.groupID}).then(function(e){e.Result&&(t.score=e.Score||0,t.total=e.Total||0,t.good=e.Good||0)}).catch(function(t){})},getDataDetail:function(){var t=this;this.$gatewayHttp.groupDiscussion.getList({groupID:this.$store.getters.groupID}).then(function(e){e.Result&&e.Datas&&e.Datas.length>0&&e.Datas.forEach(function(e){var a=t.dataList.findIndex(function(t){return i()(t.Key)===i()(e.Key)});-1===a?(t.dataList.push(e),t.dataList.forEach(function(t){t.Value.sort(function(t){return t.SubmitTime}).reverse()})):(e.Value.sort(function(t){return t.SubmitTime}).reverse(),e.Value.forEach(function(e){-1===t.dataList[a].Value.findIndex(function(t){return i()(t)===i()(e)})&&t.dataList[a].Value.push(e),t.$nextTick(function(){t.$refs.chat.scrollTop=t.$refs.chat.scrollHeight,setTimeout(function(){t.$refs.chat.scrollTop=t.$refs.chat.scrollHeight},1e3)})}))})}).catch(function(t){})},dataAdd:function(){var t=this;this.content&&this.$gatewayHttp.groupDiscussion.postDataSave({gsid:this.dataList[this.dataList.length-1].Key.GSID,studentID:this.$store.getters.studentID,groupID:this.$store.getters.groupID,gdForm:this.contentType,gdContent:this.content}).then(function(e){e.Result&&(t.content="",t.contentType=t.contentTypeDefault)}).catch(function(t){})},getDiscussionImage:function(t){return this.$gatewayHttp.resourse.picture(t,p.g.GroupSubject)},getImageFile:function(t){return this.$gatewayHttp.resourse.picture(t,p.g.GroupDiscuss)},selectPhoto:function(t){0!==this.dataList.length&&(2===t?Object(v.b)(v.a.cameraOpen,"",1,1):Object(v.b)(v.a.albumOpen,"",1,1))},afterRead:function(t){var e=this;if(console.log("接收到的base64：",t),t.length>20971520)return this.$toast("请上传小于20M的图片"),!1;if(t){var a={funType:p.g.GroupDiscuss,imgBaseString:t};this.$gatewayHttp.resourse.upload(a).then(function(a){a.Result&&(e.contentType=p.b.Picture,e.imgBase=t,e.content=a.Data,e.dataAdd())}).catch(function(t){})}}},computed:{},watch:{"$store.getters.groupDiscussion":function(t,e){t!==e&&(t.type===p.c.init?(this.getDataStatics(),this.getDataDetail(),this.dataList=[]):t.type===p.c.newMsg?this.getDataDetail():t.type===p.c.good?this.good+=t.value.IsGood?1:-1:t.type===p.c.score&&(this.score+=t.value.IsAdd?1:-1))},dataList:function(t,e){var a=this;this.$nextTick(function(){a.$refs.chat.scrollTop=a.$refs.chat.scrollHeight,setTimeout(function(){a.$refs.chat.scrollTop=a.$refs.chat.scrollHeight},1e3)})}},beforeDestroy:function(){this.imagePreview&&this.imagePreview.close()}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"group-discussion"}},[a("head-top",{attrs:{title:t.groupName}},[a("router-link",{attrs:{to:"/teamRank"}},[a("i",{staticClass:"iconfont iconchengyuan"})])],1),t._v(" "),a("div",{staticClass:"summary"},[a("div",[t._v("\n      得分数:\n      "),a("span",[t._v(t._s(t.score))])]),t._v(" "),a("div",[t._v("\n      论题:\n      "),a("span",[t._v(t._s(t.total))])]),t._v(" "),a("div",[t._v("\n      点赞数:\n      "),a("span",[t._v(t._s(t.good))])])]),t._v(" "),a("div",{ref:"chat",staticClass:"chat"},t._l(t.dataList,function(e,s){return a("div",{key:s},[a("div",{staticClass:"chat_title"},[a("span",{staticClass:"chat_title_left"},[t._v("[论题]")]),t._v(" "),e.Key.GSForm===t.contentTypeDefault?a("span",[t._v(t._s(e.Key.GSContent))]):t._e(),t._v(" "),a("img",{style:{maxWidth:"70vw",maxHeight:"15rem"},attrs:{src:t.getDiscussionImage(e.Key.GSContent)},on:{click:function(a){t.preview(t.getDiscussionImage(e.Key.GSContent))}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.Value&&e.Value.length>0,expression:"item.Value && item.Value.length>0"}],staticClass:"chat_content"},t._l(e.Value,function(e,s){return a("div",{key:s,class:e.StudentID!==t.$store.getters.studentID?"chat_item left_item":"chat_item right_item"},[a("div",{staticClass:"chat_icon"},[a("img",{attrs:{src:t.defaultPhotoImg}})]),t._v(" "),a("div",{staticClass:"chat_news"},[a("div",{staticClass:"chat_news_name"},[t._v(t._s(e.StudentName))]),t._v(" "),a("div",{staticClass:"chat_news_cont"},[e.GDForm===t.contentTypeDefault?a("span",[t._v(t._s(e.GDContent))]):a("img",{attrs:{src:t.getImageFile(e.GDContent),alt:""},on:{click:function(a){t.preview(t.getImageFile(e.GDContent))}}})])])])}),0)])}),0),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.dataList.length>0,expression:"dataList.length>0"}],staticClass:"footer"},[a("div",{staticClass:"footer_text"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{type:"text",disabled:0===t.dataList.length,placeholder:"请输入讨论内容"},domProps:{value:t.content},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataAdd(e)},input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),0===t.content.length?a("div",{staticClass:"icons"},[a("i",{staticClass:"iconfont icontupian",attrs:{disabled:0===t.dataList.length},on:{click:function(e){return t.selectPhoto(1)}}}),t._v(" "),a("i",{staticClass:"iconfont iconphotograph",attrs:{disabled:0===t.dataList.length},on:{click:function(e){return t.selectPhoto(2)}}})]):a("div",{staticClass:"icons"},[a("van-button",{attrs:{size:"small",type:"primary"},on:{click:t.dataAdd}},[t._v("发送")])],1)])],1)},staticRenderFns:[]};var D=a("VU/8")(m,_,!1,function(t){a("QPz1")},"data-v-0043fb46",null);e.default=D.exports},QPz1:function(t,e){}});
//# sourceMappingURL=32.ff949f2c31e8a549fa9e.js.map