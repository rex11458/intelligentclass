(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21c2fb66"],{"0d5e":function(t,n,i){"use strict";var e=i("267c"),s=i.n(e);s.a},"267c":function(t,n,i){},"7db0":function(t,n,i){"use strict";var e=i("23e7"),s=i("b727").find,a=i("44d2"),o=i("ae40"),r="find",c=!0,u=o(r);r in[]&&Array(1)[r]((function(){c=!1})),e({target:"Array",proto:!0,forced:c||!u},{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a(r)},"85c2":function(t,n,i){"use strict";i.r(n);var e=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{staticClass:"course-sign"},[i("head-top",{attrs:{title:"课堂签到"}},[i("span",{staticClass:"head-right",attrs:{slot:"right"},on:{click:t.toNewSign},slot:"right"},[i("span",{staticClass:"head_span"},[t._v("二次签到 ")])])]),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到模式")]),i("van-radio-group",{style:{width:"unset"},attrs:{direction:"horizontal"},on:{change:t.changeSignWay},model:{value:t.signMode,callback:function(n){t.signMode=n},expression:"signMode"}},t._l(t.options,(function(n,e){return i("van-radio",{key:e,attrs:{name:n.value}},[t._v(t._s(n.text))])})),1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1===t.signMode,expression:"signMode===1"}],staticClass:"sign_code"},[i("p",{staticClass:"sign_remark"},[t._v("学生点击签到即可签到")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.signMode,expression:"signMode===2"}],staticClass:"sign_code"},[i("canvas",{attrs:{id:"signCode"}}),i("p",{staticClass:"sign_remark"},[t._v("签到码："+t._s(t.codeValue))])]),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到统计")]),i("van-dropdown-menu",[i("van-dropdown-item",{attrs:{options:t.signStatistic},on:{change:t.changeSignTime},model:{value:t.signID,callback:function(n){t.signID=n},expression:"signID"}})],1)],1),i("div",{staticClass:"sign_List"},[i("van-circle",{attrs:{rate:t.rate,"stroke-width":60,text:t.currentNum+"人已签","layer-color":"#f3f3f3",clockwise:!1},model:{value:t.currentRate,callback:function(n){t.currentRate=n},expression:"currentRate"}})],1),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到列表")]),i("van-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return t.changeSignTime(t.signID)}}},[t._v("刷新")])],1),t.personList&&t.personList.length>0?i("van-cell-group",t._l(t.personList,(function(n,e){return i("van-cell",{key:e,staticClass:"cell_main",scopedSlots:t._u([{key:"icon",fn:function(){return[i("img",{attrs:{src:n.imgSrc,alt:""}})]},proxy:!0},{key:"title",fn:function(){return[i("span",{staticClass:"line_title"},[t._v(t._s(n.name))])]},proxy:!0},{key:"label",fn:function(){return[i("span",{staticClass:"line_title"},[t._v(t._s(n.sno))])]},proxy:!0},{key:"right-icon",fn:function(){return[n.remark?i("van-tag",{attrs:{plain:"",type:"primary"}},[t._v(t._s(n.remark))]):i("van-tag",{attrs:{plain:""}},[t._v("未签到")])]},proxy:!0}],null,!0)})})),1):i("r-lack-data")],1)},s=[],a=(i("7db0"),i("4160"),i("159b"),i("d055")),o=i.n(a),r=i("a5b7"),c=i.n(r),u=i("2241"),g={name:"signWay",data:function(){return{signMode:1,searchSignMode:-1,options:[{text:"自动签到",value:1},{text:"扫码签到",value:2}],signID:"",signStatistic:[],codeValue:"0591",currentRate:0,currentNum:0,rate:0,personList:[],isLoading:!1}},mounted:function(){this.getSignMode(),this.getSignStatistic()},methods:{getSignMode:function(){var t=this;this.$gatewayHttp.sign.getSignMode().then((function(n){n.Result?(t.signMode=n["SignModel"],t.codeValue=n["SignCode"],t.searchSignMode=n["SignModel"]):n.Info&&t.$toast(n.Info)})).catch((function(){}))},getSignStatistic:function(){var t=this;this.signStatistic=[],this.$gatewayHttp.sign.getDataStatistic().then((function(n){n.Result?n.Datas&&n.Datas.length>0&&(n.Datas.sort((function(t,n){return t["Number"]>n["Number"]?-1:1})),n.Datas.forEach((function(n){t.signStatistic.push({text:"第".concat(n["Number"],"次签到"),value:n["SNID"],number:n["Number"],courseID:n["CIID"]})})),t.signID=n.Datas[0]["SNID"],t.changeSignTime(t.signID)):n.Info&&t.$toast(n.Info)})).catch((function(){}))},changeSignTime:function(t){var n=this,i=this.signStatistic.find((function(n){return n.value===t}));this.personList=[],this.currentNum=0,this.rate=0,this.isLoading=!0,this.$gatewayHttp.sign.getDataList({number:i.number}).then((function(t){t.Result?t.Datas&&t.Datas.length>0&&(t.Datas.sort((function(t,n){return t["SignTime"]>n["SignTime"]?-1:1})),t.Datas.forEach((function(t){n.personList.push({imgSrc:c.a,name:t.Key["StudentName"],id:t.Key["StudentID"],sno:t.Key["StudentXH"],remark:t["SignTime"]}),t["SignTime"]&&n.currentNum++}))):t.Info&&n.$toast(t.Info),n.rate=n.personList.length>0?100*n.currentNum/n.personList.length:0,n.isLoading=!1})).catch((function(){n.isLoading=!1}))},toNewSign:function(){var t=this;u["a"].confirm({message:"确定再次签到吗？"}).then((function(){t.addSign()})).catch((function(){}))},addSign:function(){var t=this;this.$gatewayHttp.sign.getSign().then((function(n){n.Result?(t.$toast("启动成功"),t.getSignStatistic()):n.Info?t.$toast(n.Info):t.$toast("启动失败")})).catch((function(){t.$toast("操作失败")}))},changeSignWay:function(t){var n=this;2===t&&setTimeout((function(){n.drawCode()}),0),this.searchSignMode!==t?this.$gatewayHttp.sign.setSignMode({signModel:t}).then((function(t){t.Result?n.$toast("切换成功"):t.Info?n.$toast(t.Info):n.$toast("切换失败")})).catch((function(){n.$toast("操作失败")})):this.searchSignMode=-1},drawCode:function(){o.a.toCanvas(document.getElementById("signCode"),JSON.stringify({CIID:this.$store.getters.courseID,SignCode:this.codeValue},null,"\t"),{errorCottectionLevel:"H",margin:1,width:300},(function(t){t&&console.log(t)}))}}},l=g,d=(i("0d5e"),i("2877")),h=Object(d["a"])(l,e,s,!1,null,"aae797a0",null);n["default"]=h.exports},a5b7:function(t,n,i){t.exports=i.p+"img/boy_img.8267a8ec.png"}}]);
//# sourceMappingURL=chunk-21c2fb66.f11a1c37.js.map