(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d5145556"],{"094f":function(t,s,e){"use strict";e.r(s);var o=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"subject_view"},[e("head-top",{attrs:{title:t.title}},[e("span",{staticClass:"head-right",attrs:{slot:"right"},on:{click:t.dataDrop},slot:"right"},[e("van-icon",{attrs:{name:"delete"}})],1)]),e("class-hour-list",{on:{finish:t.classHourChange,toBegin:t.classHourBegin}}),e("class-list",{on:{finish:t.classChange,toBegin:t.classBegin}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(s){t.showPicker=s},expression:"showPicker"}},[e("van-picker",{attrs:{title:t.pickerTitle,"show-toolbar":"",columns:t.columns},on:{cancel:function(s){t.showPicker=!1},confirm:t.onConfirm}})],1)],1)},i=[],a=(e("4160"),e("fb6a"),e("b0c0"),e("ac1f"),e("5319"),e("159b"),function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"class_list"},[e("div",{staticClass:"sub_nav"},[e("span",[t._v("班级")]),e("van-icon",{attrs:{name:"plus"},on:{click:function(s){return t.$router.push("/class/edit")}}})],1),e("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.onSearch},model:{value:t.isLoading,callback:function(s){t.isLoading=s},expression:"isLoading"}},[t.classList&&t.classList.length>0?e("van-cell-group",t._l(t.classList,(function(s,o){return e("van-cell",{key:o,staticClass:"cell_main",attrs:{"is-link":"",title:s.name,label:"学生："+s.person},on:{click:function(e){return t.classClick(s)}}})})),1):e("r-lack-data")],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.classOperate,callback:function(s){t.classOperate=s},expression:"classOperate"}},[e("van-cell",{attrs:{value:"选择课时开始授课"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toBegin(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"other-pay"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"学生列表"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toStudent(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"manager-o"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"编辑"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toEdit(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"edit"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"删除"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toDrop(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"delete"},slot:"right-icon"})],1)],1)],1)}),n=[],c=e("2241"),r=e("6828"),l={name:"classList",data:function(){return{subjectID:this.$store.getters.subjectID,classList:[],classOperate:!1,classSelected:null,isLoading:!1}},mounted:function(){this.getClassList()},methods:{onSearch:function(){this.getClassList()},getClassList:function(){var t=this;this.classList=[],this.isLoading=!0,this.$mainHttp.class.dataList({courseID:this.subjectID}).then((function(s){s.Result?(s.Datas.sort((function(t,s){return t["CreateTime"]>s["CreateTime"]?-1:1})),s.Datas.forEach((function(s){t.classList.push({name:s.Key["ClassName"],createTime:Object(r["a"])(s.Key["CreateTime"],"yyyy-MM-dd"),code:s.Key["InviteCode"],person:s.Total,id:s.Key["ClassID"]})}))):s.Info&&t.$toast(s.Info),t.$emit("finish",t.classList),t.isLoading=!1})).catch((function(){t.isLoading=!1}))},classClick:function(t){this.classSelected=t,this.classOperate=!0},editClass:function(t){this.$router.push("/class/edit/"+t.id+"/"+t.name)},toBegin:function(){this.classOperate=!1,this.$emit("toBegin",this.classSelected)},toStudent:function(){this.$store.commit("SET_CLASS",this.classSelected),this.$store.commit("SET_CLASS_ID",this.classSelected.id),this.$router.push("/class/student/list")},toEdit:function(){this.$router.push("/class/edit/"+this.classSelected.id+"/"+this.classSelected.name)},toDrop:function(){var t=this;c["a"].confirm({message:"确认删除此班级？"}).then((function(){t.toDelete()})).catch((function(){}))},toDelete:function(){var t=this;this.$mainHttp.class.dataDelete({classID:this.classSelected.id,token:this.$store.getters.token}).then((function(s){s.Result?(t.classOperate=!1,t.getClassList(),t.$toast("删除成功")):s.Info?t.$toast(s.Info):t.$toast("删除失败")})).catch((function(){t.$toast("操作失败")}))}}},u=l,h=e("2877"),f=Object(h["a"])(u,a,n,!1,null,null,null),d=f.exports,p=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"class_hour_list"},[e("div",{staticClass:"sub_nav"},[e("span",[t._v("课时")]),e("van-icon",{attrs:{name:"plus"},on:{click:t.toAdd}})],1),e("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.onSearch},model:{value:t.isLoading,callback:function(s){t.isLoading=s},expression:"isLoading"}},[t.classHourList&&t.classHourList.length>0?e("van-cell-group",t._l(t.classHourList,(function(s,o){return e("van-cell",{key:o,staticClass:"cell_main",attrs:{title:s.name,label:s.createTime,"is-link":""},on:{click:function(e){return t.classHourClick(s)}}})})),1):e("r-lack-data")],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.classHourOperate,callback:function(s){t.classHourOperate=s},expression:"classHourOperate"}},[e("van-cell",{attrs:{value:"选择班级开始授课"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toBegin(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"other-pay"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"备课"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toPrepare(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"todo-list-o"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"课堂记录"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toRecord(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"todo-list-o"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"编辑"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toEdit(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"edit"},slot:"right-icon"})],1),e("van-cell",{attrs:{value:"删除"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.toDrop(s)}}},[e("van-icon",{attrs:{slot:"right-icon",name:"delete"},slot:"right-icon"})],1)],1)],1)},m=[],g={name:"classHourList",data:function(){return{subjectID:this.$store.getters.subjectID,classHourList:[],classHourSelected:null,classHourOperate:!1,isLoading:!1}},mounted:function(){this.getClassHourList()},methods:{onSearch:function(){this.getClassHourList()},getClassHourList:function(){var t=this;this.classHourList=[],this.isLoading=!0,this.$mainHttp.classHour.dataList({courseID:this.subjectID}).then((function(s){s.Result?(s.Datas.sort((function(t,s){return t["CreateTime"]>s["CreateTime"]?-1:1})),s.Datas.forEach((function(s){t.classHourList.push({name:s["CHName"],createTime:Object(r["a"])(s["CreateTime"],"yyyy-MM-dd"),code:s["SignCode"],id:s["CHID"]})}))):s.Info&&t.$toast(s.Info),t.$emit("finish",t.classHourList),t.isLoading=!1})).catch((function(){t.isLoading=!1}))},classHourClick:function(t){this.classHourSelected=t,this.classHourOperate=!0},toBegin:function(){this.classHourOperate=!1,this.$emit("toBegin",this.classHourSelected)},toPrepare:function(){this.$store.commit("SET_CLASSHOUR",this.classHourSelected),this.$store.commit("SET_CLASSHOUR_ID",this.classHourSelected.id),this.$router.push("/class-hour/prepare")},toRecord:function(){this.$store.commit("SET_CLASSHOUR",this.classHourSelected),this.$store.commit("SET_CLASSHOUR_ID",this.classHourSelected.id),this.$router.push("/course-record/list")},toAdd:function(){this.$store.commit("SET_CLASSHOUR",null),this.$store.commit("SET_CLASSHOUR_ID",""),this.$router.push("/class-hour/edit")},toEdit:function(){this.$store.commit("SET_CLASSHOUR",this.classHourSelected),this.$store.commit("SET_CLASSHOUR_ID",this.classHourSelected.id),this.$router.push("/class-hour/edit")},toDrop:function(){var t=this;c["a"].confirm({message:"确认删除当前课时？"}).then((function(){t.toDelete()})).catch((function(){}))},toDelete:function(){var t=this;this.$mainHttp.classHour.dataDelete({chID:this.classHourSelected.id,token:this.$store.getters.token}).then((function(s){s.Result?(t.classHourOperate=!1,t.getClassHourList(),t.$toast("删除成功")):s.Info?t.$toast(s.Info):t.$toast("删除失败")})).catch((function(){t.$toast("操作失败")}))}}},S=g,v=Object(h["a"])(S,p,m,!1,null,null,null),D=v.exports,$={name:"subjectView",components:{ClassList:d,ClassHourList:D},data:function(){return{title:this.$store.getters.subject.name,subjectID:this.$store.getters.subjectID,classHourList:[],classList:[],showPicker:!1,pickerTitle:"",columns:[],classHourSelected:null,classSelected:null,pickerType:1}},mounted:function(){},methods:{dataDrop:function(){var t=this;c["a"].confirm({message:"确认删除当前课程？"}).then((function(){t.dataDelete()})).catch((function(){}))},dataDelete:function(){var t=this;this.$mainHttp.course.dataDelete({courseID:this.subjectID,token:this.$store.getters.token}).then((function(s){s.Result?(t.$toast("删除成功"),t.$router.replace("/subject/list")):s.Info?t.$toast(s.Info):t.$toast("删除失败")})).catch((function(){t.$toast("操作失败")}))},classHourChange:function(t){this.classHourList.length=0,t&&t.length>0&&(this.classHourList=t.slice(0,t.length))},classHourBegin:function(t){var s=this;this.pickerTitle="请选择授课班级",this.classHourSelected=t,this.classSelected=null,this.columns=[],this.pickerType=1,this.classList.forEach((function(t){s.columns.push({text:t.name,value:t})})),this.showPicker=!0},classChange:function(t){this.classList.length=0,t&&t.length>0&&(this.classList=t.slice(0,t.length))},classBegin:function(t){var s=this;this.pickerTitle="请选择授课课时",this.classHourSelected=null,this.classSelected=t,this.columns=[],this.pickerType=2,this.classHourList.forEach((function(t){s.columns.push({text:t.name,value:t})})),this.showPicker=!0},onConfirm:function(t){var s=this;1===this.pickerType?this.classSelected=t.value:this.classHourSelected=t.value,this.showPicker=!1,this.$mainHttp.classInfo.inClassInfo({chID:this.classHourSelected.id,classID:this.classSelected.id,teacherID:this.$store.getters.teacherID}).then((function(t){if(t.Result&&t.Datas&&t.Datas.length>0){var e={id:t.Datas[0].Key["CIID"],classHourID:t.Datas[0].Key["CHID"],classID:t.Datas[0].Key["ClassID"],classRoomID:t.Datas[0].Key["ClassroomID"],classRoomName:t.Datas[0]["ClsRoomName"],teacherID:t.Datas[0].Key["TeacherID"],classDate:t.Datas[0].Key["ClassDate"],state:t.Datas[0].Key["State"],createTime:t.Datas[0].Key["CreateTime"],updateTime:t.Datas[0].Key["UpdateTime"]};s.$store.commit("SET_CLASS",s.classSelected),s.$store.commit("SET_CLASS_ID",s.classSelected.id),s.$store.commit("SET_CLASSHOUR",s.classHourSelected),s.$store.commit("SET_CLASSHOUR_ID",s.classHourSelected.id),s.$store.commit("SET_COURSE",e),s.$store.commit("SET_COURSE_ID",e.id),s.toStartCourse()}else t.Info?s.$toast(t.Info):s.toLinkCourse()})).catch((function(){s.$toast("操作失败")}))},toStartCourse:function(){var t=this;this.$store.dispatch("GetCourseServiceByUser",this.$store.getters.course.classRoomID).then((function(s){s.Result?t.linkTest():s.Info?t.$toast(s.Info):t.$toast("获取教室服务失败")})).catch((function(){t.$toast("获取教室服务出错")}))},linkTest:function(){var t=this;this.$gatewayHttp.gateway.linkTest().then((function(s){t.$router.push("/course")})).catch((function(){t.toLinkCourse()}))},toLinkCourse:function(){var t=this;this.$mainHttp.resourse.signalRPort().then((function(s){s.Result&&s["Port"]?(t.$store.commit("SET_SIGNALR_PORT",s["Port"]),t.$store.commit("SET_CLASS",t.classSelected),t.$store.commit("SET_CLASS_ID",t.classSelected.id),t.$store.commit("SET_CLASSHOUR",t.classHourSelected),t.$store.commit("SET_CLASSHOUR_ID",t.classHourSelected.id),t.$router.push("/class-hour/wait")):s.Info?t.$toast(s.info):t.$toast("请重试")})).catch((function(){t.$toast("无法获取连接信息")}))}}},C=$,H=(e("d3f6"),Object(h["a"])(C,o,i,!1,null,"b4566b60",null));s["default"]=H.exports},"4d63":function(t,s,e){var o=e("83ab"),i=e("da84"),a=e("94ca"),n=e("7156"),c=e("9bf2").f,r=e("241c").f,l=e("44e7"),u=e("ad6d"),h=e("9f7f"),f=e("6eeb"),d=e("d039"),p=e("69f3").set,m=e("2626"),g=e("b622"),S=g("match"),v=i.RegExp,D=v.prototype,$=/a/g,C=/a/g,H=new v($)!==$,L=h.UNSUPPORTED_Y,I=o&&a("RegExp",!H||L||d((function(){return C[S]=!1,v($)!=$||v(C)==C||"/a/i"!=v($,"i")})));if(I){var k=function(t,s){var e,o=this instanceof k,i=l(t),a=void 0===s;if(!o&&i&&t.constructor===k&&a)return t;H?i&&!a&&(t=t.source):t instanceof k&&(a&&(s=u.call(t)),t=t.source),L&&(e=!!s&&s.indexOf("y")>-1,e&&(s=s.replace(/y/g,"")));var c=n(H?new v(t,s):v(t,s),o?this:D,k);return L&&e&&p(c,{sticky:e}),c},_=function(t){t in k||c(k,t,{configurable:!0,get:function(){return v[t]},set:function(s){v[t]=s}})},T=r(v),b=0;while(T.length>b)_(T[b++]);D.constructor=k,k.prototype=D,f(i,"RegExp",k)}m("RegExp")},6828:function(t,s,e){"use strict";e.d(s,"a",(function(){return o}));e("fb6a"),e("4d63"),e("ac1f"),e("25f0"),e("5319");function o(t,s){if(t){var e=t;if(/(y+)/.test("yyyy-MM-dd hh:mm:ss"))try{s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))}catch(i){if(e=new Date(parseInt(t.slice(6,19))),!e||"Invalid Date"===e.toUTCString())return""}else if(e=new Date(parseInt(t.slice(6,19))),!e||"Invalid Date"===e.toUTCString())return"";var o={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),q:Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};return s=s.replace(/([yMdhmsqS])+/g,(function(t,s){var i=o[s];return void 0!==i?(t.length>1&&(i="0"+i,i=i.substr(i.length-2)),i):"y"===s?(e.getFullYear()+"").substr(4-t.length):t})),s}}},7156:function(t,s,e){var o=e("861d"),i=e("d2bb");t.exports=function(t,s,e){var a,n;return i&&"function"==typeof(a=s.constructor)&&a!==e&&o(n=a.prototype)&&n!==e.prototype&&i(t,n),t}},a916:function(t,s,e){},d3f6:function(t,s,e){"use strict";var o=e("a916"),i=e.n(o);i.a}}]);
//# sourceMappingURL=chunk-d5145556.7f2df4cf.js.map