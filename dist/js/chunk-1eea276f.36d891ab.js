(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1eea276f"],{"0133":function(t,e,s){},"13d5":function(t,e,s){"use strict";var o=s("23e7"),a=s("d58f").left,n=s("a640"),i=s("ae40"),r=n("reduce"),c=i("reduce",{1:0});o({target:"Array",proto:!0,forced:!r||!c},{reduce:function(t){return a(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"4d63":function(t,e,s){var o=s("83ab"),a=s("da84"),n=s("94ca"),i=s("7156"),r=s("9bf2").f,c=s("241c").f,u=s("44e7"),d=s("ad6d"),p=s("9f7f"),l=s("6eeb"),h=s("d039"),g=s("69f3").set,f=s("2626"),m=s("b622"),v=m("match"),b=a.RegExp,y=b.prototype,D=/a/g,I=/a/g,_=new b(D)!==D,k=p.UNSUPPORTED_Y,w=o&&n("RegExp",!_||k||h((function(){return I[v]=!1,b(D)!=D||b(I)==I||"/a/i"!=b(D,"i")})));if(w){var x=function(t,e){var s,o=this instanceof x,a=u(t),n=void 0===e;if(!o&&a&&t.constructor===x&&n)return t;_?a&&!n&&(t=t.source):t instanceof x&&(n&&(e=d.call(t)),t=t.source),k&&(s=!!e&&e.indexOf("y")>-1,s&&(e=e.replace(/y/g,"")));var r=i(_?new b(t,e):b(t,e),o?this:y,x);return k&&s&&g(r,{sticky:s}),r},C=function(t){t in x||r(x,t,{configurable:!0,get:function(){return b[t]},set:function(e){b[t]=e}})},S=c(b),$=0;while(S.length>$)C(S[$++]);y.constructor=x,x.prototype=y,l(a,"RegExp",x)}f("RegExp")},6620:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-group-discuss"},[s("head-top",{attrs:{title:"小组讨论"}},[s("div",{staticClass:"head-right",attrs:{slot:"right"},slot:"right"},[s("van-icon",{staticClass:"head-operate",attrs:{name:"close"},on:{click:t.toStop}}),s("van-icon",{staticClass:"head-operate",attrs:{name:"comment-o"},on:{click:t.toStart}})],1)]),t.groupList&&t.groupList.length>0?s("van-tabs",{attrs:{animated:"",swipeable:""},on:{change:t.groupChanged},model:{value:t.selectIndex,callback:function(e){t.selectIndex=e},expression:"selectIndex"}},t._l(t.groupList,(function(e,o){return s("van-tab",{key:o},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s(e.groupName)+" ")]),s("div",{staticClass:"sub_nav"},[s("span",[t._v("当前论题")]),s("div",[s("span",[t._v(" 点赞数："+t._s(e.result.good||0)+" ")]),s("span",{staticStyle:{"padding-left":"1rem"}},[t._v(" 得分："+t._s(e.result.score||0)+" ")])])]),s("div",{staticClass:"sub_module"},[e.subject?s("span",[t._v(" 论题"+t._s(e.subject.index)+"： "),e.subject.type===t.defaultType?s("span",[t._v(t._s(e.subject.content))]):s("img",{style:{maxWidth:"92vw",maxHeight:"35vw"},attrs:{alt:"",src:e.subject.content},on:{click:function(s){return t.preview(e.subject.content)}}})]):s("div",{staticStyle:{"text-align":"center"}},[t._v(" 暂无论题")])]),s("div",{staticClass:"sub_nav"},[s("span",[t._v("讨论内容")])]),s("div",{ref:"chat",refInFor:!0,staticClass:"chat"},[e.discussList&&e.discussList.length>0?s("div",{staticClass:"chat_content"},t._l(e.discussList,(function(o,a){return s("div",{key:a,staticClass:"chat_item left_item"},[s("div",{staticClass:"chat_icon"},[s("img",{attrs:{src:t.defaultPhotoImg,alt:""}})]),s("div",{staticClass:"chat_news"},[s("div",{staticClass:"chat_news_name"},[t._v(" "+t._s(o.studentName)+" "),s("span",{staticClass:"time"},[t._v(t._s(o.createTime))]),s("span",{staticClass:"operate"},[s("van-stepper",{attrs:{slot:"default","input-width":"10vw","button-size":"6vw",integer:"",min:"0",max:"100"},on:{change:function(s){return t.scoreSet(e,o)}},slot:"default",model:{value:o.score,callback:function(e){t.$set(o,"score",e)},expression:"sub.score"}}),s("span",{staticClass:"score"},[t._v("分")]),s("van-icon",{class:{check:o.good>0},attrs:{name:0===o.good?"good-job-o":"good-job"},on:{click:function(s){return t.goodSet(e,o)}}})],1)]),s("div",{staticClass:"chat_news_cont"},[o.type===t.defaultType?s("span",[t._v(t._s(o.content))]):s("img",{attrs:{src:o.content,alt:""},on:{click:function(e){return t.preview(o.content)}}}),s("div",{staticClass:"chat_news_arrow"})])])])})),0):s("r-lack-data")],1)])})),1):s("r-lack-data"),s("van-popup",{attrs:{position:"bottom"},model:{value:t.prepareVisible,callback:function(e){t.prepareVisible=e},expression:"prepareVisible"}},[s("van-tabs",{model:{value:t.subjectIndex,callback:function(e){t.subjectIndex=e},expression:"subjectIndex"}},[s("van-tab",[s("div",{attrs:{slot:"title"},slot:"title"},[s("van-icon",{attrs:{name:"bars"}}),t._v(" 备课题目 ")],1),t.prepareList&&t.prepareList.length>0?s("div",{staticClass:"prepare-list"},t._l(t.prepareList,(function(e,o){return s("div",{key:o},[s("div",{staticClass:"prepare-nav"},[t._v(t._s("课题"+(o+1)+"："+e.title))]),s("van-checkbox-group",{staticClass:"sub_module",attrs:{direction:"horizontal"},model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}},t._l(t.groupOptions,(function(o,a){return s("van-checkbox",{key:a,attrs:{shape:"square",name:o.value,disabled:t.prepareCheckeds.indexOf(o.value)>-1&&-1===e.checked.indexOf(o.value)}},[t._v(" "+t._s(o.text)+" ")])})),1)],1)})),0):s("r-lack-data"),s("van-button",{staticStyle:{width:"100%"},attrs:{type:"info",diasbled:t.loading},on:{click:t.prepareSubmit}},[t._v("开始讨论")])],1),s("van-tab",[s("div",{attrs:{slot:"title"},slot:"title"},[s("van-icon",{attrs:{name:"photo-o"}}),t._v(" 自定义论题 ")],1),s("div",{staticClass:"sub_nav"},[s("span",[t._v("论题类型：")]),s("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.discussForm.type,callback:function(e){t.$set(t.discussForm,"type",e)},expression:"discussForm.type"}},[s("van-radio",{attrs:{name:1}},[t._v("文本")]),s("van-radio",{attrs:{name:2}},[t._v("图片")])],1)],1),s("van-field",{attrs:{required:"",label:"讨论小组：","error-message":t.discussFormErr.groupChecked},scopedSlots:t._u([{key:"input",fn:function(){return[s("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:t.discussForm.groupChecked,callback:function(e){t.$set(t.discussForm,"groupChecked",e)},expression:"discussForm.groupChecked"}},t._l(t.groupOptions,(function(e,o){return s("van-checkbox",{key:o,attrs:{shape:"square",name:e.value}},[t._v(" "+t._s(e.text)+" ")])})),1)]},proxy:!0}])}),s("van-field",{directives:[{name:"show",rawName:"v-show",value:t.discussForm.type===t.defaultType,expression:"discussForm.type === defaultType"}],attrs:{required:"",rows:"2",label:"讨论课题：",type:"textarea",maxlength:"500","error-message":t.discussFormErr.content,placeholder:"请输入课题",autofocus:"",autosize:"","show-word-limit":"",rules:[{required:!0,message:"请填写讨论课题"}]},model:{value:t.discussForm.content,callback:function(e){t.$set(t.discussForm,"content",e)},expression:"discussForm.content"}}),s("van-field",{directives:[{name:"show",rawName:"v-show",value:t.discussForm.type!==t.defaultType,expression:"discussForm.type !== defaultType"}],attrs:{required:"",name:"uploader",label:"上传图片：","error-message":t.discussFormErr.imageID},scopedSlots:t._u([{key:"input",fn:function(){return[s("van-image",{staticClass:"upload_image",attrs:{src:t.uploadImage},on:{click:t.toUpload},scopedSlots:t._u([{key:"error",fn:function(){return[s("van-icon",{attrs:{name:"photo-o",size:"40"}})]},proxy:!0}])}),t.discussForm.imageID?s("van-icon",{staticClass:"upload_drop",attrs:{name:"cross"},on:{click:t.dropUpload}}):t._e()]},proxy:!0}])}),s("van-button",{staticStyle:{width:"100%"},attrs:{type:"info",diasbled:t.loading},on:{click:t.pictureSubmit}},[t._v("开始讨论")])],1)],1)],1)],1)},a=[],n=(s("99af"),s("4160"),s("a15b"),s("d81d"),s("13d5"),s("159b"),s("28a2")),i=s("2241"),r=s("08f3"),c=s("a5b7"),u=s.n(c),d=s("6828"),p=s("d11a"),l=s("bc3a"),h=s.n(l),g={name:"groupDiscussion",components:{},data:function(){return{groupList:[],defaultPhotoImg:u.a,selectIndex:0,groupDiscussionList:[],studentList:[],prepareSelectIndex:-1,prepareList:[],prepareVisible:!1,subjectIndex:"1",subject:null,defaultType:r["a"].Text,uploader:[],discussForm:{groupChecked:[],type:1,content:"",imageID:""},discussFormErr:{groupChecked:"",content:"",imageID:""},loading:!1,imagePreview:null}},computed:{groupOptions:function(){return this.groupList.map((function(t){return{text:t.groupName,value:t.groupID}}))},prepareCheckeds:function(){return this.prepareList.reduce((function(t,e){return t.concat(e.checked)}),[])},uploadImage:function(){return this.discussForm.imageID?this.$gatewayHttp.resourse.picture(this.discussForm.imageID,r["d"].GroupSubject):""}},mounted:function(){var t=this;this.$nextTick((function(){window.uploadImage=function(e){t.afterRead(e)}})),this.getGroupList()},methods:{getGroupList:function(){var t=this;this.groupList=[],this.$gatewayHttp.group.getLastGroupList().then((function(e){e.Result?e.Data&&e.Data.length>0&&(e.Data.forEach((function(e){t.groupList.push({groupName:e["GroupName"],groupID:e["GroupID"],gatewayID:e["GatewayID"],groupingID:e["GroupingID"],groupMax:e["GroupNumber"],studentID:e["StudentID"],result:{good:0,score:0,total:0},subject:null,discussList:[]})})),t.groupChanged(0)):e.Info&&t.$toast(e.Info)})).catch((function(){}))},groupChanged:function(t){this.selectIndex=t,this.getGroupDiscussInfo(this.groupList[t]),this.getGroupDiscussResult(this.groupList[t])},getGroupDiscussInfo:function(t){var e=this;this.$gatewayHttp.groupDiscussion.getDataInfo({groupID:t.groupID}).then((function(s){s.Result&&s.Data?(t.subject={id:s.Data["GSID"],index:s.Data["GSSort"],type:s.Data["GSForm"],content:s.Data["GSForm"]===e.defaultType?s.Data["GSContent"]:e.$gatewayHttp.resourse.picture(s.Data["GSContent"],r["d"].GroupSubject),state:s.Data["State"]},e.getGroupDiscussList(t)):s.Info&&e.$toast(s.Info)})).catch((function(){}))},getGroupDiscussResult:function(t){var e=this;this.$gatewayHttp.groupDiscussion.getDataResult({groupID:t.groupID}).then((function(s){s.Result?t.result={good:s["Good"],score:s["Score"],total:s["Total"]}:s.Info&&e.$toast(s.Info)})).catch((function(){}))},getGroupDiscussList:function(t){var e=this;t.discussList=[],this.$gatewayHttp.groupDiscussion.getDataList({gsID:t.subject.id}).then((function(s){s.Result?s.Datas&&s.Datas&&s.Datas.forEach((function(s){t.discussList.push({studentID:s.Key["StudentID"],studentName:s["StudentName"],id:s.Key["GDID"],type:s.Key["GDForm"],content:s.Key["GDForm"]===r["a"].Text?s.Key["GDContent"]:e.$gatewayHttp.resourse.picture(s.Key["GDContent"],r["d"].GroupDiscuss),createTime:Object(d["a"])(s.Key["SubmitTime"],"hh:mm:ss"),good:s.Key["GDGood"]||0,score:s.Key["GDScore"]||0})})):s.Info&&e.$toast(s.Info)})).catch((function(){}))},preview:function(t){this.imagePreview=Object(n["a"])({images:[t],showIndex:!1,onClose:function(){}})},scoreSet:function(t,e){var s=this;this.$gatewayHttp.groupDiscussion.postSetScore({gdid:e.id,gdscore:e.score}).then((function(e){e.Result?t.result.score=t.discussList.reduce((function(t,e){return t+parseInt(e.score)}),0):e.Info?s.$toast(e.Info):s.$toast("编辑失败")})).catch((function(){s.$toast("操作失败")}))},goodSet:function(t,e){var s=this,o=Math.abs(e.good-1);this.$gatewayHttp.groupDiscussion.postSetGood({gdid:e.id,gdgood:o}).then((function(a){a.Result?(e.good=o,t.result.good=t.discussList.reduce((function(t,e){return t+e.good}),0)):a.Info?s.$toast(a.Info):s.$toast("编辑失败")})).catch((function(){s.$toast("操作失败")}))},toStop:function(){var t=this;i["a"].confirm({title:"提示",message:"是否结束当前所有小组论题？"}).then((function(){var e=t.groupList.map((function(t){return t.groupID})).join(",");t.$gatewayHttp.groupDiscussion.postSetStop({groupID:e}).then((function(e){e.Result?t.$toast("结束讨论成功"):e.Info?t.$toast(e.Info):t.$toast("结束讨论失败")})).catch((function(){t.$toast("操作失败")}))})).catch((function(){}))},toStart:function(){this.prepareSelectIndex=-1,this.uploader=[],this.subjectIndex="1",this.discussForm={groupChecked:[],type:1,content:"",imageID:""},this.discussFormErr={groupChecked:"",content:"",imageID:""},this.getPrepareDiscussList(),this.prepareVisible=!0},getPrepareDiscussList:function(){var t=this;this.prepareList=[],this.$mainHttp.prepareGroupSubject.dataList({CHID:this.$store.getters.classHourID}).then((function(e){e.Result?(e.Datas.sort((function(t,e){return t["CreateTime"]>e["CreateTime"]?-1:1})),e.Datas.forEach((function(e){t.prepareList.push({title:e["PGSContent"],createTime:Object(d["a"])(e["CreateTime"],"yyyy-MM-dd"),other:e["PGSTime"],id:e["PGSID"],checked:[]})}))):e.Info&&t.$toast(e.Info)})).catch((function(){}))},prepareSubmit:function(){var t=this;if(0!==this.prepareCheckeds.length){var e=[];this.loading=!0,this.prepareList.forEach((function(s){s.checked.length>0&&e.push(t.$gatewayHttp.groupDiscussion.postSetStart({groupID:s.checked.join(","),gsContent:s.title,gsForm:t.defaultType}))})),e.length>0&&h.a.all(e).then(h.a.spread((function(){for(var e=[],s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];o.forEach((function(t,s){t.Result||e.push(s)})),0===e.length?(t.$toast("新建讨论成功"),t.groupChanged(t.selectIndex),t.prepareVisible=!1):1===e.length&&e.length<o.length?(t.$toast("部分讨论未创建成功，请刷新重试"),t.groupChanged(t.selectIndex),t.prepareVisible=!1):t.$toast("操作失败！"),t.loading=!1}))).catch((function(){t.$toast("操作失败！"),t.loading=!1}))}else this.$toast("请给讨论课题指定小组")},toUpload:function(){Object(p["b"])(p["a"].albumOpen,"")},afterRead:function(t){var e=this;if(console.log("接收到的base64：",t),t.length>20971520)return this.$toast("请上传小于20M的图片"),!1;if(t){var s={funType:r["d"].GroupSubject,imgBaseString:t};this.$gatewayHttp.resourse.upload(s).then((function(t){t.Result&&(e.discussForm.imageID=t.Data)})).catch((function(){}))}},dropUpload:function(){this.discussForm.imageID=""},pictureSubmit:function(){var t=this;return this.discussFormErr={groupChecked:"",content:"",imageID:""},this.discussForm.groupChecked.length<=0?(this.$toast("请选择讨论小组!"),void(this.discussFormErr.groupChecked="请选择讨论小组")):this.discussForm.type===this.defaultType&&this.discussForm.content.length<=0?(this.$toast("请填写课题内容!"),void(this.discussFormErr.content="请填写课题内容")):this.discussForm.type!==this.defaultType&&this.discussForm.imageID.length<=0?(this.$toast("请上传课题图片!"),void(this.discussFormErr.content="请上传课题图片")):(this.loading=!0,void this.$gatewayHttp.groupDiscussion.postSetStart({groupID:this.discussForm.groupChecked.join(","),gsContent:this.discussForm.type===this.defaultType?this.discussForm.content:this.discussForm.imageID,gsForm:this.discussForm.type}).then((function(e){e.Result?(t.$toast("新建讨论成功"),t.groupChanged(t.selectIndex),t.prepareVisible=!1):e.Info?t.$toast(e.Info):t.$toast("新建讨论失败"),t.loading=!1})).catch((function(){t.$toast("操作失败"),t.loading=!1})))}},beforeDestroy:function(){this.imagePreview&&this.imagePreview.close()}},f=g,m=(s("b88d"),s("2877")),v=Object(m["a"])(f,o,a,!1,null,"42217fd9",null);e["default"]=v.exports},6828:function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));s("fb6a"),s("4d63"),s("ac1f"),s("25f0"),s("5319");function o(t,e){if(t){var s=t;if(/(y+)/.test("yyyy-MM-dd hh:mm:ss"))try{e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length))}catch(a){if(s=new Date(parseInt(t.slice(6,19))),!s||"Invalid Date"===s.toUTCString())return""}else if(s=new Date(parseInt(t.slice(6,19))),!s||"Invalid Date"===s.toUTCString())return"";var o={M:s.getMonth()+1,d:s.getDate(),h:s.getHours(),m:s.getMinutes(),s:s.getSeconds(),q:Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};return e=e.replace(/([yMdhmsqS])+/g,(function(t,e){var a=o[e];return void 0!==a?(t.length>1&&(a="0"+a,a=a.substr(a.length-2)),a):"y"===e?(s.getFullYear()+"").substr(4-t.length):t})),e}}},7156:function(t,e,s){var o=s("861d"),a=s("d2bb");t.exports=function(t,e,s){var n,i;return a&&"function"==typeof(n=e.constructor)&&n!==s&&o(i=n.prototype)&&i!==s.prototype&&a(t,i),t}},a5b7:function(t,e,s){t.exports=s.p+"img/boy_img.8267a8ec.png"},b88d:function(t,e,s){"use strict";var o=s("0133"),a=s.n(o);a.a},d58f:function(t,e,s){var o=s("1c0b"),a=s("7b0b"),n=s("44ad"),i=s("50c4"),r=function(t){return function(e,s,r,c){o(s);var u=a(e),d=n(u),p=i(u.length),l=t?p-1:0,h=t?-1:1;if(r<2)while(1){if(l in d){c=d[l],l+=h;break}if(l+=h,t?l<0:p<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:p>l;l+=h)l in d&&(c=s(c,d[l],l,u));return c}};t.exports={left:r(!1),right:r(!0)}}}]);
//# sourceMappingURL=chunk-1eea276f.36d891ab.js.map