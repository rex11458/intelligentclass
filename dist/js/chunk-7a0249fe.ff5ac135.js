(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a0249fe"],{"6d9c":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"course-cloud-disk"},[i("head-top",{attrs:{title:"云盘"}},[i("span",{directives:[{name:"show",rawName:"v-show",value:1===e.activeIndex&&e.typeValue,expression:"activeIndex === 1 && typeValue"}],staticClass:"head-back head-first",attrs:{slot:"left"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.toBack(t)}},slot:"left"},[i("i",{staticClass:"iconfont icon-fanhui"})]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.fileList.length>0,expression:"fileList.length>0"}],attrs:{slot:"right"},slot:"right"},[e.editMode?i("span",[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:e.fileChecked.length>0,expression:"fileChecked.length>0"}],staticClass:"head-right",attrs:{name:"delete"},on:{click:e.toAllDrop}}),i("van-icon",{staticClass:"head-right",attrs:{"class-prefix":"iconfont icon-fanhui1"},on:{click:function(t){e.editMode=!1}}})],1):i("van-icon",{staticClass:"head-right",attrs:{"class-prefix":"iconfont icon-duoxuananniu"},on:{click:e.changeMode}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.activeIndex&&!e.typeValue,expression:"activeIndex === 1 && !typeValue"}],staticClass:"content"},e._l(e.typeList,(function(t,s){return i("van-cell-group",{key:s,staticClass:"cell_group"},[i("van-cell",{staticClass:"cell_main",attrs:{title:t.name,"is-link":""},on:{click:function(i){return e.typeClick(t)}}})],1)})),1),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.activeIndex||e.typeValue,expression:"activeIndex === 0 || typeValue"}],staticClass:"content"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.editMode,expression:"!editMode"}],staticClass:"search_input"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词"},on:{search:e.searchData},model:{value:e.keyValue,callback:function(t){e.keyValue=t},expression:"keyValue"}})],1),i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:!e.editMode,expression:"!editMode"}],staticClass:"pull_fresh",attrs:{"head-height":80},on:{refresh:e.searchData},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[e.fileList&&e.fileList.length>0?i("van-cell-group",e._l(e.fileList,(function(t,s){return i("van-cell",{key:s,staticClass:"cell_main",on:{click:function(i){return e.fileClick(t)}}},[i("template",{slot:"icon"},[i("van-icon",{staticClass:"cell_icon",attrs:{"class-prefix":"iconfont icon-kejian"}})],1),i("template",{slot:"title"},[i("div",{staticClass:"line_title"},[e._v(e._s(t.fileName+"."+t.fileExt))])]),i("template",{slot:"label"},[i("div",{staticClass:"line_title"},[t.fileSize>1048576?i("span",[e._v(" "+e._s(Math.round(t.fileSize/1024/10.24)/100)+" MB ")]):i("span",[e._v(" "+e._s(Math.round(t.fileSize/10.24)/100)+" KB ")]),e.inCourse&&e.courseFileList&&e.courseFileList.find((function(e){return e.id===t.id}))?i("van-tag",{staticStyle:{"margin-left":"3vw"},attrs:{plain:"",type:"success"}},[e._v(" 课中 ")]):e._e()],1)])],2)})),1):i("r-lack-data")],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.editMode,expression:"editMode"}]},[i("van-checkbox-group",{model:{value:e.fileChecked,callback:function(t){e.fileChecked=t},expression:"fileChecked"}},[i("van-cell-group",e._l(e.fileList,(function(t,s){return i("van-cell",{key:s,staticClass:"cell_main",attrs:{clickable:""},on:{click:function(i){return e.fileCheck(t)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("van-icon",{staticClass:"cell_icon",attrs:{"class-prefix":"iconfont icon-kejian"}})]},proxy:!0},{key:"title",fn:function(){return[i("div",{staticClass:"line_title"},[e._v(" "+e._s(t.fileName+"."+t.fileExt))])]},proxy:!0},{key:"label",fn:function(){return[i("div",{staticClass:"line_title"},[t.fileSize>1048576?i("span",[e._v(" "+e._s(Math.round(t.fileSize/1024/10.24)/100)+" MB ")]):i("span",[e._v(" "+e._s(Math.round(t.fileSize/10.24)/100)+" KB ")])])]},proxy:!0}],null,!0)},[i("van-checkbox",{attrs:{slot:"right-icon",sharp:"square",name:t.id},slot:"right-icon"})],1)})),1)],1)],1)],1),i("div",{staticClass:"footer"},[i("van-tabbar",{model:{value:e.activeIndex,callback:function(t){e.activeIndex=t},expression:"activeIndex"}},e._l(e.menus,(function(t,s){return i("van-tabbar-item",{key:s,on:{click:function(i){return e.handleClick(t)}}},[i("i",{staticClass:" iconfont",class:t.icon,attrs:{slot:"icon"},slot:"icon"}),i("span",[e._v(e._s(t.name))])])})),1)],1),i("van-popup",{attrs:{position:"bottom"},model:{value:e.fileOperate,callback:function(t){e.fileOperate=t},expression:"fileOperate"}},[i("van-cell",{directives:[{name:"show",rawName:"v-show",value:e.fileSelected&&(e.canOpenFileExt.indexOf(e.fileSelected.fileExt)>-1||2===e.fileSelected.fileTransformed),expression:"fileSelected && (canOpenFileExt.indexOf(fileSelected.fileExt) > -1 || fileSelected.fileTransformed === 2)"}],attrs:{value:"预览"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.toPreView(t)}}},[i("van-icon",{attrs:{slot:"right-icon","class-prefix":"iconfont icon-chakan_yulan"},slot:"right-icon"})],1),e.inCourse&&e.courseFileList&&e.fileSelected&&!e.courseFileList.find((function(t){return t.id===e.fileSelected.id}))?i("van-cell",{attrs:{value:"设为课堂"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.setCourse(t)}}},[i("van-icon",{attrs:{slot:"right-icon","class-prefix":"iconfont icon-xinxitongbu"},slot:"right-icon"})],1):e._e(),e.inCourse&&e.courseFileList&&e.fileSelected&&e.courseFileList.find((function(t){return t.id===e.fileSelected.id}))?i("van-cell",{attrs:{value:"取消课堂"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.cancelCourse(t)}}},[i("van-icon",{attrs:{slot:"right-icon","class-prefix":"iconfont icon-xinxitongbu"},slot:"right-icon"})],1):e._e(),i("van-cell",{attrs:{value:"删除"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.toDrop(t)}}},[i("van-icon",{attrs:{slot:"right-icon","class-prefix":"iconfont icon-shanchu"},slot:"right-icon"})],1)],1)],1)},a=[],n=(i("c740"),i("4160"),i("c975"),i("a15b"),i("a434"),i("159b"),i("1e55")),o=i("6828"),l={name:"cloudDisk",data:function(){return{activeIndex:0,menus:[{name:"全部文件",index:0,icon:"icon-quanbuwenjian"},{name:"分类文件",index:1,icon:"icon-fenlei"}],typeList:[],keyValue:"",typeValue:"",fileList:[],isLoading:!1,fileSelected:null,fileOperate:!1,canOpenFileExt:["txt","bmp","gif","jpg","png","ico"],fileChecked:[],editMode:!1,inCourse:this.$route.path.indexOf("course")>-1,course:this.$store.getters.course,courseFileList:[]}},mounted:function(){this.getTypeList(),this.handleClick(this.menus[0]),this.inCourse&&this.getCourseWareList()},methods:{getTypeList:function(){var e=this;this.typeList=[],this.$mainHttp.materialType.typeList().then((function(t){t.Result?t.Datas&&t.Datas.length>0&&t.Datas.forEach((function(t){e.typeList.push({id:t["MTypeID"],isSystem:t["MTIsSystem"],code:t["MTCode"],name:t["MTypename"],remark:t["MTDescription"]})})):t.Info&&e.$toast(t.Info)})).catch((function(){}))},handleClick:function(e){this.fileList=[],this.typeValue="",this.keyValue="",0===e.index&&this.searchData()},typeClick:function(e){this.typeValue=e.id,this.searchData()},searchData:function(){var e=this;this.fileList=[],this.isLoading=!0,this.$mainHttp.material.dataList({key:this.keyValue,mtid:this.typeValue,uid:this.$store.getters.userID,sfield:"",sdir:""}).then((function(t){t.Result?t.Data&&t.Data.length>0&&t.Data.forEach((function(t){e.fileList.push({id:t["MaterialID"],directoryID:t["DirectoryID"],fileName:t["MaterialName"],fileExt:t["MaterialFileExt"],fileSize:t["MaterialFileSize"]||0,fileTransformed:t["MaterialLowStreamEstate"],createTime:Object(o["a"])(t["MaterialCreateDate"],"yyyy-MM-dd")})})):t.Info&&e.$toast(t.Info),e.isLoading=!1})).catch((function(){e.isLoading=!1}))},changeMode:function(){this.fileChecked=[],this.editMode=!0},toBack:function(){this.typeValue=""},fileCheck:function(e){var t=this.fileChecked.findIndex((function(t){return t===e.id}));t>-1?this.fileChecked.splice(t,1):this.fileChecked.push(e.id)},toAllDrop:function(){var e=this;0===this.fileCheck.length?this.$toast("请选择需要删除的文件"):n["Dialog"].confirm({message:"确认删除所有选中的文件？"}).then((function(){e.toALLDelete()})).catch((function(){}))},toALLDelete:function(){var e=this;this.$mainHttp.dirs.dataDelete({ids:this.fileChecked.join(","),token:this.$store.getters.token}).then((function(t){t.Result?(e.editMode=!1,e.searchData(),e.$toast("批量删除成功")):t.Info?e.$toast(t.Info):e.$toast("批量删除失败")})).catch((function(){e.$toast("操作失败")}))},fileClick:function(e){this.fileOperate=!0,this.fileSelected=e},toDrop:function(){var e=this;n["Dialog"].confirm({message:"确认删除当前课时？"}).then((function(){e.toDelete()})).catch((function(){}))},toDelete:function(){var e=this;this.$mainHttp.dirs.dataDelete({ids:this.fileSelected.id,token:this.$store.getters.token}).then((function(t){t.Result?(e.searchData(),e.fileOperate=!1,e.$toast("删除成功")):t.Info?e.$toast(t.Info):e.$toast("删除失败")})).catch((function(){e.$toast("操作失败")}))},toPreView:function(){this.$store.commit("SET_CLOUD_FILE",this.fileSelected),this.$store.getters.course&&this.$mainHttp.classInfo.openSource({ciID:this.$store.getters.courseID,materialID:this.fileSelected.id,materialName:this.fileSelected.fileName,materialFileExt:this.fileSelected.fileExt}),this.$router.push("/cloud-disk/file-view")},setCourse:function(){var e=this;this.$mainHttp.courseWare.dataAdd({chID:this.course.classHourID,materialIDs:this.fileSelected.id,attribute:2,classID:this.course.classID}).then((function(t){t.Result?(e.fileOperate=!1,e.getCourseWareList(),e.$toast("设为课堂成功")):t.Info?e.$toast(t.Info):e.$toast("设为课堂失败")})).catch((function(){e.$toast("操作失败")}))},cancelCourse:function(){var e=this,t=this.courseFileList.findIndex((function(t){return t.id===e.fileSelected.id})),i=this.courseFileList[t].remarkID;this.$mainHttp.courseWare.dataDelete({ids:i,classID:this.course.classID}).then((function(i){i.Result?(t>-1&&e.courseFileList.splice(t,1),e.fileOperate=!1,e.$toast("取消课堂成功")):i.Info?e.$toast(i.Info):e.$toast("取消课堂失败")})).catch((function(){e.$toast("操作失败")}))},getCourseWareList:function(){var e=this;this.courseFileList=[],this.$mainHttp.courseWare.inCourseList({chID:this.$store.getters.classHourID,classID:this.$store.getters.classID}).then((function(t){t.Result?t.Datas&&t.Datas.length>0&&t.Datas.forEach((function(t){e.courseFileList.push({remarkID:t.Key["CID"],id:t.Key["MaterialID"]})})):t.Info&&e.$toast(t.Info)})).catch((function(){}))}}},c=l,r=(i("78f2"),i("2877")),u=Object(r["a"])(c,s,a,!1,null,"06ab1582",null);t["default"]=u.exports},"78f2":function(e,t,i){"use strict";var s=i("88c7"),a=i.n(s);a.a},"88c7":function(e,t,i){},a434:function(e,t,i){"use strict";var s=i("23e7"),a=i("23cb"),n=i("a691"),o=i("50c4"),l=i("7b0b"),c=i("65f0"),r=i("8418"),u=i("1dde"),f=i("ae40"),h=u("splice"),d=f("splice",{ACCESSORS:!0,0:0,1:2}),p=Math.max,v=Math.min,m=9007199254740991,k="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!h||!d},{splice:function(e,t){var i,s,u,f,h,d,g=l(this),x=o(g.length),C=a(e,x),D=arguments.length;if(0===D?i=s=0:1===D?(i=0,s=x-C):(i=D-2,s=v(p(n(t),0),x-C)),x+i-s>m)throw TypeError(k);for(u=c(g,s),f=0;f<s;f++)h=C+f,h in g&&r(u,f,g[h]);if(u.length=s,i<s){for(f=C;f<x-s;f++)h=f+s,d=f+i,h in g?g[d]=g[h]:delete g[d];for(f=x;f>x-s+i;f--)delete g[f-1]}else if(i>s)for(f=x-s;f>C;f--)h=f+s-1,d=f+i-1,h in g?g[d]=g[h]:delete g[d];for(f=0;f<i;f++)g[f+C]=arguments[f+2];return g.length=x-s+i,u}})}}]);