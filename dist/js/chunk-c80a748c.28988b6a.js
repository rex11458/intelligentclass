(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c80a748c"],{"1b16":function(e,i,t){"use strict";var n=t("46e8"),a=t.n(n);a.a},"2df1":function(e,i,t){"use strict";var n=t("fc9a"),a=t.n(n);a.a},"46e8":function(e,i,t){},5899:function(e,i){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,i,t){var n=t("1d80"),a=t("5899"),o="["+a+"]",l=RegExp("^"+o+o+"*"),s=RegExp(o+o+"*$"),f=function(e){return function(i){var t=String(n(i));return 1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(s,"")),t}};e.exports={start:f(1),end:f(2),trim:f(3)}},"5b93":function(e,i,t){},"7db0":function(e,i,t){"use strict";var n=t("23e7"),a=t("b727").find,o=t("44d2"),l=t("ae40"),s="find",f=!0,r=l(s);s in[]&&Array(1)[s]((function(){f=!1})),n({target:"Array",proto:!0,forced:f||!r},{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},"9ae7":function(e,i,t){"use strict";t.r(i);var n=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"file-view"},[t("head-top",{attrs:{title:"文件预览"}}),t("r-file-view",{attrs:{"file-id":e.fileInfo.id,"file-name":e.fileInfo.fileName,"file-ext":e.fileInfo.fileExt,"file-total":e.fileTotal},on:{changePageIndex:e.changePageIndex}})],1)},a=[],o=(t("7db0"),function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{ref:"main",staticClass:"file-preview",attrs:{id:"file-preview"},on:{scroll:e.lazyLoad}},[t("div",{ref:"head",staticClass:"head-sticky"},["txt"!==e.fileExt&&"mp4"!==e.fileExt?t("span",[e._v(e._s(e.fileTotal)+"-"+e._s(e.active))]):e._e()]),t("div",{staticClass:"file-main"},["txt"===e.fileExt?t("div",{staticClass:"file-txt"},[t("h2",[e._v(e._s(e.fullName))]),t("p",[e._v(" "+e._s(e.txtContent)+" ")])]):e.canOpenFileExt.indexOf(e.fileExt)>-1?t("div",[t("image-view",{attrs:{"file-id":e.fileId,"file-ext":e.fileExt,"file-total":1,index:1,"auto-load":""},on:{preview:e.imageView}}),t("h2",[e._v(e._s(e.fullName))])],1):t("div",[t("h2",[e._v(e._s(e.fullName))]),e._l(e.viewTotal,(function(i){return t("image-view",{key:i,ref:"img"+i,refInFor:!0,staticClass:"lazy",attrs:{"file-id":e.fileId,"file-ext":e.fileExt,"file-total":e.fileTotal,index:i},on:{finish:e.handleFinish,preview:function(t){return e.toView(i)}}})})),t("van-image-preview",{attrs:{"start-position":e.startIndex,images:e.viewImages,loop:!1},on:{change:e.onChange},scopedSlots:e._u([{key:"index",fn:function(){return[e._v("第"+e._s(e.viewIndex)+"页，共"+e._s(e.fileTotal)+"页")]},proxy:!0}]),model:{value:e.viewShow,callback:function(i){e.viewShow=i},expression:"viewShow"}})],2)])])}),l=[],s=(t("c740"),t("4160"),t("c975"),t("a434"),t("b0c0"),t("a9e3"),t("159b"),t("ade3")),f=t("1e55"),r=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{ref:"img",staticClass:"image-view"},[t("img",{staticStyle:{"object-fit":"fill"},attrs:{src:e.file,alt:"",width:"100%"},on:{click:e.view}}),e.loadFail?t("div",{on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.init(i)}}},[e._v("加载失败，点击重新加载")]):e._e(),e.indexShow&&(e.loadFail||e.isLoad)?t("div",{staticClass:"remark"},[e._v(e._s(e.index))]):e._e()])},c=[],d=(t("ace4"),t("d3b7"),t("5cc6"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),{name:"imageView",props:{fileId:{type:String,required:!0},fileExt:{type:String,required:!0},index:{type:Number,default:1},fileTotal:{type:Number,default:0},autoLoad:{type:Boolean,default:!1}},data:function(){return{isLoad:!1,loading:!1,loadFail:!1,file:null}},computed:{indexShow:function(){return-1===["bmp","gif","jpg","png","ico"].indexOf(this.fileExt)}},mounted:function(){this.autoLoad&&this.init()},methods:{init:function(){var e=this;this.loading||this.isLoad||(this.loading=!0,this.$mainHttp.common.viewFile({mid:this.fileId,suffix:this.fileExt,index:this.index}).then((function(i){for(var t=new Uint8Array(i),n="",a=0;a<t.byteLength;a++)n+=String.fromCharCode(t[a]);switch(e.fileExt){case"png":e.file="data:image/png;base64,"+window.btoa(n);break;case"gif":e.file="data:image/gif;base64,"+window.btoa(n);break;case"x-icon":e.file="data:image/x-icon;base64,"+window.btoa(n);break;default:e.file="data:image/jpeg;base64,"+window.btoa(n);break}e.loading=!1,e.isLoad=!0,setTimeout((function(){e.loadFail||e.$emit("finish",e.index)}))})).catch((function(){e.loading=!1,e.loadFail||e.$emit("finish",e.index),e.loadFail=!0})))},view:function(){this.loadFail||this.$emit("preview",this.file)}}}),h=d,u=(t("a089"),t("2877")),m=Object(u["a"])(h,r,c,!1,null,"46870ffe",null),g=m.exports,v={name:"r-file-view",components:Object(s["a"])({ImageView:g},f["ImagePreview"].name,f["ImagePreview"].install()),props:{fileId:{type:String,required:!0},fileName:{type:String,required:!0},fileExt:{type:String,required:!0},fileTotal:{type:Number,default:0}},data:function(){return{canOpenFileExt:["txt","bmp","gif","jpg","png","ico"],txtContent:"",loadIndex:1,finishedHeight:0,canLoad:!0,active:1,viewTotal:1,allFinished:!1,startIndex:0,viewIndex:1,viewShow:!1,viewImages:[]}},computed:{fullName:function(){return this.fileName+"."+this.fileExt}},mounted:function(){},methods:{load:function(){this.init(),window.addEventListener("scroll",this.lazyLoad);var e=document.getElementById("file-preview");e&&e.addEventListener("scroll",this.lazyLoad)},init:function(){var e=this;if("txt"===this.fileExt)this.$mainHttp.common.viewTxt({mid:this.fileId}).then((function(i){i.Result?e.txtContent=i.Data:e.txtContent="加载失败"})).catch((function(){e.txtContent="加载异常"}));else if(-1===this.canOpenFileExt.findIndex((function(i){return i===e.fileExt}))){this.viewImages=[];for(var i=0;i<this.fileTotal;i++)this.viewImages.push("");this.$nextTick((function(){e.lazyLoad()}))}},lazyLoad:function(){var e=this;this.fileTotal<1||this.canOpenFileExt.indexOf(this.fileExt)>-1||(this.scrollPage(),this.allFinished||setTimeout((function(){e.loadImage(e.loadIndex)}),200))},scrollPage:function(){var e=document.querySelectorAll(".lazy"),i=[];e.forEach((function(e){i.push(e.offsetTop)}));for(var t=document.documentElement.scrollTop||document.body.scrollTop,n=document.getElementById("file-preview"),a=n.scrollTop,o=0,l=0;l<i.length;l++)if(t>=i[l]&&t>0)o=l+1;else{if(!(a>=i[l]&&a>0))break;o=l+1}this.active=o>=this.fileTotal?this.fileTotal:o+1},loadImage:function(e){if(!(e>this.fileTotal)){var i=this.$refs["img"+e]?this.$refs["img"+e][0]||this.$refs["img"+e]:null;if(i&&this.canLoad&&!i.isLoad){var t=window.innerHeight,n=document.documentElement.scrollTop||document.body.scrollTop,a=document.getElementById("file-preview").scrollTop,o=document.querySelectorAll(".lazy"),l=o.length>0?o[o.length-1].offsetTop:0,s=t+n+t/2>=this.finishedHeight||t+n+t/2>=l,f=t+a+t/2>=this.finishedHeight||t+a+t/2>=l;(s||f)&&(this.viewTotal++,this.canLoad=!1,i.init(),e>=this.fileTotal&&(this.allFinished=!0))}}},handleFinish:function(e){this.loadIndex++,this.canLoad=!0;var i=this.$refs["img"+e][0].$el.offsetHeight;this.finishedHeight+=i,this.viewImages.splice(e-1,1,this.$refs["img"+e][0].file),this.lazyLoad()},imageView:function(e){this.$store.commit("SET_IMAGE_PREVIEW",e)},toView:function(e){this.startIndex=e-1,this.onChange(e-1),this.viewShow=!0},onChange:function(e){var i=this.viewIndex;if(this.viewIndex=e+1,e===i){var t=this.viewIndex+1;if(!this.viewImages[t]&&t<=this.fileTotal){var n=this.$refs["img"+t][0]||this.$refs["img"+t];this.viewTotal++,this.canLoad=!1,n.init(),e>=this.fileTotal&&(this.allFinished=!0)}}this.$emit("changePageIndex",this.viewIndex)}},watch:{fileTotal:{immediate:!0,handler:function(e,i){console.log(e,i),this.load()}},active:function(e,i){this.$emit("changePageIndex",e)}},beforeDestroy:function(){window.removeEventListener("scroll",this.lazyLoad);var e=document.getElementById("file-preview");e&&e.removeEventListener("scroll",this.lazyLoad),this.imagePreview&&this.imagePreview.close()}},p=v,x=(t("2df1"),Object(u["a"])(p,o,l,!1,null,"0c12258f",null)),w=x.exports,I=w,b={name:"fileView",components:{RFileView:I},beforeRouteLeave:function(e,i,t){this.$mainHttp.classInfo.sourceSetClose({ciID:this.$store.getters.courseID}).then((function(e){})).catch((function(){})),t()},data:function(){return{canOpenFileExt:["txt","bmp","gif","jpg","png","ico"],fileInfo:this.$store.getters.cloudFile,fileTotal:0}},mounted:function(){this.init()},methods:{init:function(){var e=this;this.canOpenFileExt.find((function(i){return i===e.fileInfo.fileExt}))||(this.fileTotal=0,this.$mainHttp.material.fileConvertCount({mid:this.fileInfo.id}).then((function(i){i.Result?e.fileTotal=i.Total:i.Info?(e.$toast(i.Info),e.fileTotal=0):e.fileTotal=0})).catch((function(){e.fileTotal=0})))},changePageIndex:function(e){this.$store.getters.course&&this.$mainHttp.classInfo.turnToPageIndex({ciID:this.$store.getters.courseID,mid:this.fileInfo.id,suffix:this.fileInfo.fileExt,index:e})}}},E=b,T=(t("1b16"),Object(u["a"])(E,n,a,!1,null,"4d89ebc6",null));i["default"]=T.exports},a089:function(e,i,t){"use strict";var n=t("5b93"),a=t.n(n);a.a},a434:function(e,i,t){"use strict";var n=t("23e7"),a=t("23cb"),o=t("a691"),l=t("50c4"),s=t("7b0b"),f=t("65f0"),r=t("8418"),c=t("1dde"),d=t("ae40"),h=c("splice"),u=d("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,g=Math.min,v=9007199254740991,p="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!h||!u},{splice:function(e,i){var t,n,c,d,h,u,x=s(this),w=l(x.length),I=a(e,w),b=arguments.length;if(0===b?t=n=0:1===b?(t=0,n=w-I):(t=b-2,n=g(m(o(i),0),w-I)),w+t-n>v)throw TypeError(p);for(c=f(x,n),d=0;d<n;d++)h=I+d,h in x&&r(c,d,x[h]);if(c.length=n,t<n){for(d=I;d<w-n;d++)h=d+n,u=d+t,h in x?x[u]=x[h]:delete x[u];for(d=w;d>w-n+t;d--)delete x[d-1]}else if(t>n)for(d=w-n;d>I;d--)h=d+n-1,u=d+t-1,h in x?x[u]=x[h]:delete x[u];for(d=0;d<t;d++)x[d+I]=arguments[d+2];return x.length=w-n+t,c}})},a9e3:function(e,i,t){"use strict";var n=t("83ab"),a=t("da84"),o=t("94ca"),l=t("6eeb"),s=t("5135"),f=t("c6b6"),r=t("7156"),c=t("c04e"),d=t("d039"),h=t("7c73"),u=t("241c").f,m=t("06cf").f,g=t("9bf2").f,v=t("58a8").trim,p="Number",x=a[p],w=x.prototype,I=f(h(w))==p,b=function(e){var i,t,n,a,o,l,s,f,r=c(e,!1);if("string"==typeof r&&r.length>2)if(r=v(r),i=r.charCodeAt(0),43===i||45===i){if(t=r.charCodeAt(2),88===t||120===t)return NaN}else if(48===i){switch(r.charCodeAt(1)){case 66:case 98:n=2,a=49;break;case 79:case 111:n=8,a=55;break;default:return+r}for(o=r.slice(2),l=o.length,s=0;s<l;s++)if(f=o.charCodeAt(s),f<48||f>a)return NaN;return parseInt(o,n)}return+r};if(o(p,!x(" 0o1")||!x("0b1")||x("+0x1"))){for(var E,T=function(e){var i=arguments.length<1?0:e,t=this;return t instanceof T&&(I?d((function(){w.valueOf.call(t)})):f(t)!=p)?r(new x(b(i)),t,T):b(i)},y=n?u(x):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;y.length>_;_++)s(x,E=y[_])&&!s(T,E)&&g(T,E,m(x,E));T.prototype=w,w.constructor=T,l(a,p,T)}},fc9a:function(e,i,t){}}]);