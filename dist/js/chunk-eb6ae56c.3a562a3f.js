(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eb6ae56c"],{"13a6":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"home-course"}},[o("head-top",{attrs:{title:"课程","show-back":!1}},[o("r-dropdown",{ref:"DropDown",staticClass:"head_right",attrs:{slot:"right"},slot:"right"},[o("van-icon",{ref:"Scan",staticClass:"head_right",attrs:{name:"scan"}}),o("div",{attrs:{slot:"menu"},slot:"menu"},[o("div",{staticClass:"head_menu_item",on:{click:t.scanOpen}},[t._v("扫一扫")]),o("div",{staticClass:"head_menu_item",on:{click:t.codeOpen}},[t._v("邀请码")])])],1)],1),o("van-tabs",{on:{change:t.changeCourse},model:{value:t.headTopActive,callback:function(e){t.headTopActive=e},expression:"headTopActive"}},[o("van-tab",{attrs:{title:"正在上课"}},[t.$store.getters.nowCourse?o("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.changeCourse},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[o("course-list",{staticClass:"list_card",attrs:{"course-type":"current",course:[t.$store.getters.nowCourse]}})],1):o("div",{staticStyle:{"padding-top":"5rem","font-size":"1.5rem","line-height":"2.5rem"}},[t._v(" 请点击右上角的 "),o("van-icon",{style:{fontSize:"1.8rem",color:"#fff",background:"#00cbab"},attrs:{name:"scan"}}),o("div",[t._v("选择 扫一扫 或 邀请码 加入课程")])],1)],1),o("van-tab",{attrs:{title:"历史课程"}},[o("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.changeCourse},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[o("van-list",{attrs:{finished:t.historyCourse.finished,"finished-text":"没有更多了",error:t.historyCourse.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){return t.$set(t.historyCourse,"error",e)},load:t.historyStudentCourse},model:{value:t.historyCourse.loading,callback:function(e){t.$set(t.historyCourse,"loading",e)},expression:"historyCourse.loading"}})],1)],1)],1),o("van-popup",{model:{value:t.invitedShow,callback:function(e){t.invitedShow=e},expression:"invitedShow"}},[o("div",{staticClass:"invite_main"},[o("p",{staticClass:"invite_title"},[t._v("请输入邀请码")]),o("p",{staticClass:"invite_remark"},[t._v("请在下方输入邀请码加入班级")]),o("div",{staticClass:"invite_input"},t._l(t.invitedCode.length,(function(e,s){return o("van-field",{key:s,ref:"ref"+s,refInFor:!0,staticClass:"invite_text",staticStyle:{width:"3rem"},attrs:{type:"digit",maxlength:"1",oninput:"value=value.replace(/[^0-9]/g,'')"},on:{textInput:function(e){return t.onTextInput(s,e)},input:function(e){return t.onInput(s)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.onDelete(s)}},model:{value:t.invitedCode[s],callback:function(e){t.$set(t.invitedCode,s,e)},expression:"invitedCode[index]"}})})),1),o("div",{staticClass:"invite_operate"},[o("van-button",{staticClass:"invite_btn",attrs:{type:"primary",loading:t.invitedLoading},on:{click:t.submitInvitedCode}},[t._v(" 加入班级 ")])],1)])])],1)},n=[];o("7db0"),o("4160"),o("c975"),o("a15b"),o("a434"),o("159b"),o("a4d3"),o("e01a"),o("d28b"),o("e260"),o("d3b7"),o("3ca3"),o("ddb0");function i(t){return i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}var a=o("49d1"),r=o("d11a"),c=o("ed08"),u={name:"",components:{RDropdown:a["a"]},props:{},data:function(){return{headTopActive:0,nowDate:Object(c["c"])(),currentCourse:{form:{startDate:Object(c["e"])("date",-7),endDate:Object(c["c"])(),stuid:this.$store.getters.studentID||"",psize:1,pno:0,estate:1},total:0,loading:!1,error:!1,finished:!1,data:[]},historyCourse:{form:{key:"",startDate:Object(c["e"])("date",-365),endDate:Object(c["c"])(),stuid:this.$store.getters.studentID||"",psize:10,pno:0,estate:2},total:0,loading:!1,error:!1,finished:!1,data:[]},isLoading:!1,invitedShow:!1,invitedCode:["","","","","",""],invitedLoading:!1,classRoomID:""}},beforeRouteEnter:function(t,e,o){o((function(t){e.path.indexOf("/history")>-1&&(t.headTopActive=1),t.$gatewayHttp.gateway.linkTest().then((function(e){t.$gatewayHttp.student.validateCourse().then((function(e){e.Result&&e.Data&&e.Data.CIID!==t.$store.getters.nowCourse.CIID&&t.$store.commit("SET_NOWCOURSE",null)})).catch((function(){}))})).catch((function(){t.$store.commit("SET_NOWCOURSE",null)}))}))},created:function(){var t=this;window.acceptQRcode=function(e){console.log("接收扫码：",e);var o=t.isJsonString(e);return t.joinClass(o&&o.CIID?o.CIID:o,"scan"),!0}},mounted:function(){var t=this;this.$nextTick((function(){t.$store.getters.localIP||Object(r["b"])(r["a"].initLocalIP,"").then((function(e){e&&t.$store.commit("SET_IP",e)}))}))},methods:{isJsonString:function(t){try{if("object"===i(JSON.parse(t)))return JSON.parse(t)}catch(e){}return t},scanOpen:function(){this.$refs.DropDown.hide(),Object(r["b"])(r["a"].openQRcode,"")},codeOpen:function(){var t=this;this.$refs.DropDown.hide(),this.invitedCode=["","","","","",""],this.invitedShow=!0,setTimeout((function(){t.$refs.ref0[0].focus()}),100)},onTextInput:function(t,e){this.invitedCode.splice(t,1,e.data)},onInput:function(t){this.invitedCode[t]&&t<5&&this.$refs["ref"+(t+1)][0].focus()},onDelete:function(t){t>0&&this.$refs["ref"+(t-1)][0].focus()},submitInvitedCode:function(){var t=this.invitedCode.find((function(t){return!t}));t>-1?this.$toast("请输入投屏码"):this.joinClass(this.invitedCode.join(""),"code")},joinClass:function(t,e){var o=this,s={CIID:"scan"===e?t:"",studentID:this.$store.getters.studentID,studentName:this.$store.getters.student.StudentName,studentXH:this.$store.getters.userName,inviteCode:"code"===e?t:""};this.$store.dispatch("JoinClassByUser",s).then((function(t){t.Result?(o.classRoomID=t.ClassroomID,o.courseInfoGet()):t.Info?o.$toast(t.Info):o.$toast("邀请码不正确")})).catch((function(){o.$toast("请求异常")}))},courseInfoGet:function(){var t=this;this.$mainHttp.classInfo.dataInfo({ciID:this.$store.getters.courseID||""}).then((function(e){if(e.Result&&e.Datas&&e.Datas.length>0){var o=e.Datas[0],s={CHID:o.Key.CHID,CIID:o.Key.CIID,ClassID:o.Key.ClassID,ClassroomID:o.Key.ClassroomID,ClassroomName:o.ClsRoomName,TeacherID:o.Key.TeacherID,TeacherName:o.TeacherName,ClassName:o.ClassName,CHName:o.CHName,CourseName:o.CourseName,ClassDate:o.Key.ClassDate,CreateTime:o.Key.CreateTime};t.$store.commit("SET_COURSE",s),t.$store.commit("SET_COURSEID",o.Key.CIID),t.$store.commit("SET_NOWCOURSE",s),t.classRoomGet()}else e.Info?t.$toast(e.Info):t.$toast("获取课程信息失败")})).catch((function(){t.$toast("请求异常")}))},classRoomGet:function(){var t=this;this.$store.dispatch("GetCourseServiceByUser",this.classRoomID).then((function(e){e.Result?t.linkClassRoom():e.Info?t.$toast(e.Info):t.$toast("获取教室服务失败")})).catch((function(){t.$toast("获取教室服务出错")}))},linkClassRoom:function(){var t=this,e={studentName:this.$store.getters.student.StudentName,studentXH:this.$store.getters.userName,classID:this.$store.getters.classID,studentID:this.$store.getters.studentID,csID:this.$store.getters.classStudentID};this.$gatewayHttp.class.joinClass(e).then((function(e){e.Result?t.$router.push("/course"):e.Info?t.$toast(e.Info):(t.$toast("加入班级失败"),t.$store.commit("SET_NOWCOURSE",null))})).catch((function(){t.$store.commit("SET_NOWCOURSE",null),t.$toast("请求异常")}))},currentStudentCourse:function(){var t=this,e=this.currentCourse;if(this.isLoading=!0,e.loading=!0,!(0===e.form.pno||e.total>e.form.pno*e.form.psize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.form.pno++,this.$mainHttp.classInfo.dataList(this.currentCourse.form).then((function(o){o.Result&&o.Datas&&o.Datas.length>0&&o.Datas.forEach((function(e){t.currentCourse.data.push(e)})),o.RowsCount&&(e.total=o.RowsCount),e.total>1&&(e.total=1),e.total<=e.form.pno*e.form.psize&&(e.finished=!0),e.loading=!1,t.isLoading=!1})).catch((function(){e.error=!0,e.loading=!1,t.isLoading=!1}))},historyStudentCourse:function(){var t=this,e=this.historyCourse;if(this.isLoading=!0,e.loading=!0,!(0===e.form.pno||e.total>e.form.pno*e.form.psize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.form.pno++,this.$mainHttp.classInfo.dataList(this.historyCourse.form).then((function(o){o.Result&&o.Datas&&o.Datas.length>0&&o.Datas.forEach((function(e){var o={CHID:e.Key.CHID,CIID:e.Key.CIID,ClassID:e.Key.ClassID,ClassroomID:e.Key.ClassroomID,ClassroomName:e.ClsRoomName,TeacherID:e.Key.TeacherID,TeacherName:e.TeacherName,ClassName:e.ClassName,CHName:e.CHName,CourseName:e.CourseName,ClassDate:e.Key.ClassDate,CreateTime:e.Key.CreateTime};t.historyCourse.data.find((function(t){return JSON.stringify(t)===JSON.stringify(o)}))||t.historyCourse.data.push(o)})),o.RowsCount&&(e.total=o.RowsCount),e.total<=e.form.pno*e.form.psize&&(e.finished=!0),e.loading=!1,t.isLoading=!1})).catch((function(){e.error=!0,e.loading=!1,t.isLoading=!1}))},changeCourse:function(){if(0===this.headTopActive){this.currentCourse.form.pno=0,this.currentCourse.total=0,this.currentCourse.error=!1,this.currentCourse.finished=!1,this.currentCourse.data=[];var t=this.currentCourse;t.finished=!0,t.loading=!1,this.isLoading=!1}else this.historyCourse.form.pno=0,this.historyCourse.total=0,this.historyCourse.error=!1,this.historyCourse.finished=!1,this.historyCourse.data=[],this.historyStudentCourse()}}},d=u,l=(o("2ec0"),o("2877")),h=Object(l["a"])(d,s,n,!1,null,null,null);e["default"]=h.exports},"2ec0":function(t,e,o){"use strict";var s=o("90a2"),n=o.n(s);n.a},"49d1":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"downMain",staticClass:"r-dropdown"},[o("div",{ref:"downInfo",staticClass:"down-info",on:{click:function(e){return t.toggleMenu(e)}}},[t._t("default")],2),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showMenu,expression:"showMenu"}],ref:"downMenu",staticClass:"dropdown-menu",style:t.positionStyle},[t._t("menu")],2)])},n=[],i={name:"r-dropdown",data:function(){return{showMenu:!1,positionStyle:{top:"20px",left:"20px"}}},props:{selected:{}},created:function(){},mounted:function(){this.selectedOption=this.selected,document.addEventListener("click",this.hidePanel,!1)},destroyed:function(){document.removeEventListener("click",this.hidePanel,!1)},methods:{updateOption:function(t){this.selectedOption=t,this.$emit("updateOption",this.selectedOption)},toggleMenu:function(t){var e=this;this.showMenu=!this.showMenu;var o=document.body.clientWidth,s=document.body.clientHeight;setTimeout((function(){var t=e.$refs.downInfo.getBoundingClientRect(),n=e.$refs.downMenu.getBoundingClientRect();console.log("info:",t),console.log("menu:",n);var i=0,a=0;i=t.width>=n.width?t.left+(t.width-n.width)/2:o-(t.left+(t.width-n.width)/2)>=n.width?t.left+(t.width-n.width)/2:o-n.width-5,a=n.height>=s-t.bottom+5?t.top-n.height+5:n.height<s-t.bottom-5?t.top+5:t.height+t.top-5,e.positionStyle={top:a+"px",left:i+"px"}}),10)},closeBtnGroup:function(){this.showMenu=!1},hide:function(){var t=this;setTimeout((function(){t.showMenu=!1}),150)},hidePanel:function(t){this.$refs.downMain.contains(t.target)||(this.showMenu=!1)}}},a=i,r=o("2877"),c=Object(r["a"])(a,s,n,!1,null,null,null),u=c.exports;e["a"]=u},"7db0":function(t,e,o){"use strict";var s=o("23e7"),n=o("b727").find,i=o("44d2"),a=o("ae40"),r="find",c=!0,u=a(r);r in[]&&Array(1)[r]((function(){c=!1})),s({target:"Array",proto:!0,forced:c||!u},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i(r)},"90a2":function(t,e,o){},a434:function(t,e,o){"use strict";var s=o("23e7"),n=o("23cb"),i=o("a691"),a=o("50c4"),r=o("7b0b"),c=o("65f0"),u=o("8418"),d=o("1dde"),l=o("ae40"),h=d("splice"),f=l("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,C=Math.min,p=9007199254740991,v="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!h||!f},{splice:function(t,e){var o,s,d,l,h,f,g=r(this),y=a(g.length),I=n(t,y),D=arguments.length;if(0===D?o=s=0:1===D?(o=0,s=y-I):(o=D-2,s=C(m(i(e),0),y-I)),y+o-s>p)throw TypeError(v);for(d=c(g,s),l=0;l<s;l++)h=I+l,h in g&&u(d,l,g[h]);if(d.length=s,o<s){for(l=I;l<y-s;l++)h=l+s,f=l+o,h in g?g[f]=g[h]:delete g[f];for(l=y;l>y-s+o;l--)delete g[l-1]}else if(o>s)for(l=y-s;l>I;l--)h=l+s-1,f=l+o-1,h in g?g[f]=g[h]:delete g[f];for(l=0;l<o;l++)g[l+I]=arguments[l+2];return g.length=y-s+o,d}})}}]);
//# sourceMappingURL=chunk-eb6ae56c.3a562a3f.js.map