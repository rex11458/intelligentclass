(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26dbbc23"],{"2ae2":function(t,n,i){"use strict";var s=i("ab45"),e=i.n(s);e.a},"85c2":function(t,n,i){"use strict";i.r(n);var s=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("div",{staticClass:"course-sign"},[i("head-top",{attrs:{title:"课堂签到"}},[i("span",{staticClass:"head-right",attrs:{slot:"right"},on:{click:t.toNewSign},slot:"right"},[i("span",{staticClass:"head_span"},[t._v("二次签到 ")])])]),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到模式")]),i("van-radio-group",{style:{width:"unset"},attrs:{direction:"horizontal"},on:{change:t.changeSignWay},model:{value:t.signMode,callback:function(n){t.signMode=n},expression:"signMode"}},t._l(t.options,(function(n,s){return i("van-radio",{key:s,attrs:{name:n.value}},[t._v(t._s(n.text))])})),1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1===t.signMode,expression:"signMode===1"}],staticClass:"sign_code"},[i("p",{staticClass:"sign_remark"},[t._v("学生点击签到即可签到")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.signMode,expression:"signMode===2"}],staticClass:"sign_code"},[i("canvas",{attrs:{id:"signCode"}}),i("p",{staticClass:"sign_remark"},[t._v("签到码："+t._s(t.codeValue))])]),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到统计")]),i("van-dropdown-menu",[i("van-dropdown-item",{attrs:{options:t.signStatistic},on:{change:t.changeSignTime},model:{value:t.signID,callback:function(n){t.signID=n},expression:"signID"}})],1)],1),i("div",{staticClass:"sign_List"},[i("van-circle",{attrs:{rate:t.signCount.doneRate,"stroke-width":60,text:t.signCount.done+"人已签","layer-color":"#f3f3f3",clockwise:!1},model:{value:t.signCount.doneRate,callback:function(n){t.$set(t.signCount,"doneRate",n)},expression:"signCount.doneRate"}})],1),i("div",{staticClass:"sub_nav"},[i("span",[t._v("签到列表")]),i("van-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return t.changeSignTime(t.signID)}}},[t._v("刷新")])],1),t.personList&&t.personList.length>0?i("van-cell-group",t._l(t.personList,(function(n,s){return i("van-cell",{key:s,staticClass:"cell_main",scopedSlots:t._u([{key:"icon",fn:function(){return[i("img",{directives:[{name:"real-img",rawName:"v-real-img",value:[n.userID,n.id],expression:"[item.userID, item.id]"}],attrs:{src:t.defaultHead,alt:""}})]},proxy:!0},{key:"title",fn:function(){return[i("span",{staticClass:"line_title"},[t._v(t._s(n.name))])]},proxy:!0},{key:"label",fn:function(){return[i("span",{staticClass:"line_title"},[t._v(t._s(n.sno))])]},proxy:!0},{key:"right-icon",fn:function(){return[n.remark?i("van-tag",{attrs:{plain:"",type:"primary"}},[t._v(t._s(t._f("formatTime")(n.remark,n.remark)))]):i("van-tag",{attrs:{plain:""}},[t._v("未签到")])]},proxy:!0}],null,!0)})})),1):i("r-lack-data")],1)},e=[],a=(i("4160"),i("159b"),i("d055")),o=i.n(a),r=i("1e55"),c={name:"signWay",data:function(){return{defaultHead:i("a5b7"),signMode:1,searchSignMode:-1,options:[{text:"自动签到",value:1},{text:"扫码签到",value:2}],signID:"",signNumber:0,signStatistic:[],signCount:{done:0,unDone:0,doneRate:0},codeValue:"0591",personList:[],isLoading:!1}},mounted:function(){this.init()},methods:{init:function(){this.SignLastInfo(),this.SignTimeList()},SignLastInfo:function(){var t=this;this.$mainHttp.sign.getLastSignInfo({ciID:this.$store.getters.courseID}).then((function(n){if(n.Result){var i=n.Data;t.signMode=i["Pattern"],t.searchSignMode=i["Pattern"],t.signID=i["SNID"],t.codeValue=i["SignCode"],t.signNumber=i["Number"]}})).catch((function(){}))},SignTimeList:function(){var t=this;this.signStatistic=[],this.$mainHttp.sign.getSignList({ciID:this.$store.getters.courseID}).then((function(n){n.Datas&&n.Datas.length>0&&(n.Datas.sort((function(t,n){return t["Number"]>n["Number"]?-1:1})),n.Datas.forEach((function(n){t.signStatistic.push({text:"第".concat(n["Number"],"次签到"),value:n["SNID"],number:n["Number"],courseID:n["CIID"]})})),t.signID=n.Datas[0]["SNID"],t.changeSignTime(t.signID))})).catch((function(){}))},changeSignTime:function(t){this.getSignStatistic(t),this.getSignPerson(t)},getSignPerson:function(t){var n=this;this.personList=[],this.isLoading=!0,this.$mainHttp.sign.getDataList({ciID:this.$store.getters.courseID,classID:this.$store.getters.classID,snID:t}).then((function(t){t.Result?t.Datas&&t.Datas.length>0&&(t.Datas.sort((function(t,n){return t.Value["SignTime"]>n.Value["SignTime"]?-1:1})),t.Datas.forEach((function(t){n.personList.push({name:t.Key["StudentName"],id:t.Key["StudentID"],userID:t.Key["UserID"],sno:t.Key["StudentXH"],remark:t.Value["SignID"]?t.Value["SignTime"]:""})}))):t.Info&&n.$toast(t.Info),n.isLoading=!1})).catch((function(){n.isLoading=!1}))},getSignStatistic:function(t){var n=this;this.$mainHttp.sign.getDataStatistic({snID:t,classID:this.$store.getters.classID}).then((function(t){t.Result?(n.signCount={done:t["Sign"],unDone:t["NoSign"],doneRate:0},n.signCount.done+n.signCount.unDone>0&&(n.signCount.doneRate=100*n.signCount.done/n.signCount.unDone)):t.Info&&n.$toast(t.Info)})).catch((function(){}))},toNewSign:function(){var t=this;r["Dialog"].confirm({message:"确定再次签到吗？"}).then((function(){t.addSign()})).catch((function(){}))},addSign:function(){var t=this;this.$mainHttp.sign.newSign({ciID:this.$store.getters.courseID}).then((function(n){n.Result?(t.signMode=1,t.$toast("启动成功"),t.init()):n.Info?t.$toast(n.Info):t.$toast("启动失败")})).catch((function(){t.$toast("操作失败")}))},changeSignWay:function(t){var n=this;2===t&&setTimeout((function(){n.drawCode()}),0),this.searchSignMode!==t?this.$mainHttp.sign.setSignMode({ciID:this.$store.getters.courseID,snID:this.signID,pattern:t}).then((function(t){t.Result?n.$toast("切换成功"):t.Info?n.$toast(t.Info):n.$toast("切换失败")})).catch((function(){n.$toast("操作失败")})):this.searchSignMode=-1},drawCode:function(){o.a.toCanvas(document.getElementById("signCode"),JSON.stringify({CIID:this.$store.getters.courseID,SignCode:this.codeValue},null,"\t"),{errorCottectionLevel:"H",margin:1,width:300},(function(t){t&&console.log(t)}))}}},u=c,g=(i("2ae2"),i("2877")),l=Object(g["a"])(u,s,e,!1,null,"476d98f0",null);n["default"]=l.exports},ab45:function(t,n,i){}}]);