(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9f28861c"],{"0b20":function(t,e,s){},"13d5":function(t,e,s){"use strict";var o=s("23e7"),i=s("d58f").left,n=s("a640"),a=s("ae40"),r=n("reduce"),c=a("reduce",{1:0});o({target:"Array",proto:!0,forced:!r||!c},{reduce:function(t){return i(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},6620:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-group-discuss"},[s("head-top",{attrs:{title:"小组讨论"}},[s("div",{staticClass:"head-right",attrs:{slot:"right"},slot:"right"},[s("van-icon",{staticClass:"head-operate",attrs:{name:"close"},on:{click:t.toStop}}),s("van-icon",{staticClass:"head-operate",attrs:{name:"comment-o"},on:{click:t.toStart}})],1)]),t.groupList&&t.groupList.length>0?s("van-tabs",{attrs:{animated:"",swipeable:""},on:{change:t.groupChanged},model:{value:t.selectIndex,callback:function(e){t.selectIndex=e},expression:"selectIndex"}},t._l(t.groupList,(function(e,o){return s("van-tab",{key:o},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s(e.groupName)+" ")]),s("div",{staticClass:"sub_nav"},[s("span",[t._v("当前论题")]),s("div",[s("span",[t._v(" 点赞数："+t._s(e.result.good||0)+" ")]),s("span",{staticStyle:{"padding-left":"1rem"}},[t._v(" 得分："+t._s(e.result.score||0)+" ")])])]),s("div",{staticClass:"sub_module"},[e.subject?s("span",{staticClass:"module-title"},[t._v(" 论题"+t._s(e.subject.index)+"： "),e.subject.type===t.defaultType?s("span",[t._v(t._s(e.subject.content))]):s("img",{style:{maxWidth:"92vw",maxHeight:"35vw"},attrs:{alt:"",src:e.subject.content},on:{click:function(s){return t.preview(e.subject.content)}}})]):s("div",{staticStyle:{"text-align":"center"}},[t._v(" 暂无论题")])]),s("div",{staticClass:"sub_nav"},[s("span",[t._v("讨论内容")])]),s("div",{ref:"chat",refInFor:!0,staticClass:"chat"},[e.discussList&&e.discussList.length>0?s("div",{staticClass:"chat_content"},t._l(e.discussList,(function(o,i){return s("div",{key:i,staticClass:"chat_item left_item"},[s("div",{staticClass:"chat_icon"},[s("img",{directives:[{name:"real-img",rawName:"v-real-img",value:[o.userID,o.studentID],expression:"[sub.userID, sub.studentID]"}],attrs:{src:t.defaultHead,alt:""}})]),s("div",{staticClass:"chat_news"},[s("div",{staticClass:"chat_news_name"},[t._v(" "+t._s(o.studentName)+" "),s("span",{staticClass:"time"},[t._v(t._s(o.createTime))]),s("span",{staticClass:"operate"},[s("van-button",{staticClass:"operate_btn",attrs:{size:"mini",disabled:o.score<=0},on:{click:function(s){return t.scoreSet(e,o,-1)}}},[t._v(" - ")]),s("span",{staticClass:"operate_score"},[t._v(t._s(o.score))]),s("van-button",{staticClass:"operate_btn",attrs:{size:"mini",disabled:o.score>=100},on:{click:function(s){return t.scoreSet(e,o,1)}}},[t._v(" + ")]),s("span",{staticClass:"score"},[t._v("分")]),s("van-icon",{class:{check:o.good>0},attrs:{name:0===o.good?"good-job-o":"good-job"},on:{click:function(s){return t.goodSet(e,o)}}})],1)]),s("div",{staticClass:"chat_news_cont"},[o.type===t.defaultType?s("span",[t._v(t._s(o.content))]):s("img",{attrs:{src:o.content,alt:""},on:{click:function(e){return t.preview(o.content)}}}),s("div",{staticClass:"chat_news_arrow"})])])])})),0):s("r-lack-data")],1)])})),1):s("r-lack-data"),s("van-popup",{attrs:{position:"bottom"},model:{value:t.prepareVisible,callback:function(e){t.prepareVisible=e},expression:"prepareVisible"}},[s("van-tabs",{model:{value:t.subjectIndex,callback:function(e){t.subjectIndex=e},expression:"subjectIndex"}},[s("van-tab",[s("div",{attrs:{slot:"title"},slot:"title"},[s("van-icon",{attrs:{name:"bars"}}),t._v(" 备课题目 ")],1),t.prepareList&&t.prepareList.length>0?s("div",{staticClass:"prepare-list"},t._l(t.prepareList,(function(e,o){return s("div",{key:o},[s("div",{staticClass:"prepare-nav"},[t._v(t._s("课题"+(o+1)+"："+e.title))]),s("van-checkbox-group",{staticClass:"sub_module",attrs:{direction:"horizontal"},model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}},t._l(t.groupOptions,(function(o,i){return s("van-checkbox",{key:i,attrs:{shape:"square",name:o.value,disabled:t.prepareCheckeds.indexOf(o.value)>-1&&-1===e.checked.indexOf(o.value)}},[t._v(" "+t._s(o.text)+" ")])})),1)],1)})),0):s("r-lack-data"),s("van-button",{staticStyle:{width:"100%"},attrs:{type:"info",disabled:t.loading||t.groupOptions.length!==t.prepareCheckeds.length},on:{click:t.prepareSubmit}},[t._v("开始讨论 ")])],1),s("van-tab",[s("div",{attrs:{slot:"title"},slot:"title"},[s("van-icon",{attrs:{name:"photo-o"}}),t._v(" 自定义论题 ")],1),s("div",{staticClass:"sub_nav"},[s("span",[t._v("论题类型：")]),s("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.discussForm.type,callback:function(e){t.$set(t.discussForm,"type",e)},expression:"discussForm.type"}},[s("van-radio",{attrs:{name:1}},[t._v("文本")]),s("van-radio",{attrs:{name:2}},[t._v("图片")])],1)],1),s("van-field",{attrs:{required:"",label:"讨论小组：","error-message":t.discussFormErr.groupChecked},scopedSlots:t._u([{key:"input",fn:function(){return[s("van-checkbox-group",{attrs:{direction:"horizontal"},model:{value:t.discussForm.groupChecked,callback:function(e){t.$set(t.discussForm,"groupChecked",e)},expression:"discussForm.groupChecked"}},t._l(t.groupOptions,(function(e,o){return s("van-checkbox",{key:o,attrs:{shape:"square",name:e.value}},[t._v(" "+t._s(e.text)+" ")])})),1)]},proxy:!0}])}),s("van-field",{directives:[{name:"show",rawName:"v-show",value:t.discussForm.type===t.defaultType,expression:"discussForm.type === defaultType"}],attrs:{required:"",rows:"2",label:"讨论课题：",type:"textarea",maxlength:"500","error-message":t.discussFormErr.content,placeholder:"请输入课题",autofocus:"",autosize:"","show-word-limit":"",rules:[{required:!0,message:"请填写讨论课题"}]},model:{value:t.discussForm.content,callback:function(e){t.$set(t.discussForm,"content",e)},expression:"discussForm.content"}}),s("van-field",{directives:[{name:"show",rawName:"v-show",value:t.discussForm.type!==t.defaultType,expression:"discussForm.type !== defaultType"}],attrs:{required:"",name:"uploader",label:"上传图片：","error-message":t.discussFormErr.imageID},scopedSlots:t._u([{key:"input",fn:function(){return[s("van-image",{staticClass:"upload_image",attrs:{src:t.uploadImage},on:{click:t.toUpload},scopedSlots:t._u([{key:"error",fn:function(){return[s("van-icon",{attrs:{name:"photo-o",size:"40"}})]},proxy:!0}])}),t.discussForm.imageID?s("van-icon",{staticClass:"upload_drop",attrs:{name:"cross"},on:{click:t.dropUpload}}):t._e()]},proxy:!0}])}),s("van-button",{staticStyle:{width:"100%"},attrs:{type:"info",disabled:t.loading||t.groupOptions.length!==t.discussForm.groupChecked.length},on:{click:t.pictureSubmit}},[t._v("开始讨论 ")])],1)],1)],1)],1)},i=[],n=(s("99af"),s("c740"),s("4160"),s("a15b"),s("d81d"),s("13d5"),s("159b"),s("1e55")),a=s("08f3"),r=s("6828"),c=s("d11a"),u=s("bc3a"),d=s.n(u),p={name:"groupDiscussion",components:{},data:function(){return{groupList:[],defaultHead:s("a5b7"),selectIndex:0,groupDiscussionList:[],studentList:[],prepareSelectIndex:-1,prepareList:[],prepareVisible:!1,subjectIndex:"1",subject:null,defaultType:a["a"].Text,uploader:[],discussForm:{groupChecked:[],type:1,content:"",imageID:""},discussFormErr:{groupChecked:"",content:"",imageID:""},loading:!1}},computed:{groupOptions:function(){return this.groupList.map((function(t){return{text:t.groupName,value:t.groupID}}))},prepareCheckeds:function(){return this.prepareList.reduce((function(t,e){return t.concat(e.checked)}),[])},uploadImage:function(){return this.discussForm.imageID?this.$mainHttp.common.picture(this.discussForm.imageID,a["e"].GroupSubject):""}},mounted:function(){this.getGroupList()},methods:{initUpload:function(){var t=this;window.uploadImage=function(e){t.afterRead(e)}},getGroupList:function(){var t=this;this.groupList=[],this.$mainHttp.group.getGroupLastList({ciID:this.$store.getters.courseID}).then((function(e){e.Result?e.Datas&&e.Datas.length>0&&(e.Datas.forEach((function(e){t.groupList.push({groupName:e["GroupName"],groupID:e["GroupID"],gatewayID:e["GatewayID"],groupingID:e["GroupingID"],groupMax:e["GroupNumber"],studentID:e["StudentID"],result:{good:0,score:0,total:0},subject:null,discussList:[]})})),t.groupChanged(0)):e.Info&&t.$toast(e.Info)})).catch((function(){}))},groupChanged:function(t){this.selectIndex=t,this.getGroupDiscussInfo(this.groupList[t]),this.getGroupDiscussResult(this.groupList[t])},getGroupDiscussInfo:function(t){var e=this;this.$mainHttp.groupDiscussion.getGroupLastSubject({groupID:t.groupID}).then((function(s){s.Result&&s.Data?(t.subject={id:s.Data["GSID"],index:s.Data["GSSort"],type:s.Data["GSForm"],content:s.Data["GSForm"]===e.defaultType?s.Data["GSContent"]:e.$mainHttp.common.picture(s.Data["GSContent"],a["e"].GroupSubject),state:s.Data["State"]},e.getGroupDiscussList(t)):s.Info&&e.$toast(s.Info)})).catch((function(){}))},getGroupDiscussResult:function(t){var e=this;this.$mainHttp.groupDiscussion.getDataResult({groupID:t.groupID}).then((function(s){s.Result?t.result={good:s["Good"],score:s["Score"],total:s["Total"]}:s.Info&&e.$toast(s.Info)})).catch((function(){}))},getGroupDiscussList:function(t){var e=this;t.discussList=[],this.$mainHttp.groupDiscussion.getDataList({gsID:t.subject.id}).then((function(s){s.Result?s.Datas&&s.Datas&&s.Datas.forEach((function(s){t.discussList.push({studentID:s.Key["StudentID"],userID:s["UserID"],studentName:s["StudentName"],id:s.Key["GDID"],type:s.Key["GDForm"],content:s.Key["GDForm"]===a["a"].Text?s.Key["GDContent"]:e.$mainHttp.common.picture(s.Key["GDContent"],a["e"].GroupDiscuss),createTime:Object(r["a"])(s.Key["SubmitTime"],"hh:mm:ss"),good:s.Key["GDGood"]||0,score:s.Key["GDScore"]||0})})):s.Info&&e.$toast(s.Info)})).catch((function(){}))},preview:function(t){this.$store.commit("SET_IMAGE_PREVIEW",t)},scoreSet:function(t,e,s){var o=this;if(e.score+=s,e.score||0===e.score){var i=t.discussList.reduce((function(t,e){return t+parseInt(e.score)}),0);this.$mainHttp.groupDiscussion.postSetScore({ciID:this.$store.getters.courseID,groupID:t.groupID,gdID:e.id,gsID:t.subject.id,gdScore:e.score,isAdd:1===s}).then((function(e){e.Result?t.result.score=i:e.Info?o.$toast(e.Info):o.$toast("编辑失败")})).catch((function(){o.$toast("操作失败")}))}},goodSet:function(t,e){var s=this,o=Math.abs(e.good-1);this.$mainHttp.groupDiscussion.postSetGood({ciID:this.$store.getters.courseID,groupID:t.groupID,gdID:e.id,gsID:t.subject.id,gdGood:o}).then((function(i){i.Result?(e.good=o,t.result.good=t.discussList.reduce((function(t,e){return t+e.good}),0)):i.Info?s.$toast(i.Info):s.$toast("编辑失败")})).catch((function(){s.$toast("操作失败")}))},toStop:function(){var t=this;n["Dialog"].confirm({title:"提示",message:"是否结束当前所有小组论题？"}).then((function(){t.$mainHttp.groupDiscussion.postSetStop({ciID:t.$store.getters.courseID}).then((function(e){e.Result?t.$toast("结束讨论成功"):e.Info?t.$toast(e.Info):t.$toast("结束讨论失败")})).catch((function(){t.$toast("操作失败")}))})).catch((function(){}))},toStart:function(){this.prepareSelectIndex=-1,this.uploader=[],this.subjectIndex="1",this.discussForm={groupChecked:[],type:1,content:"",imageID:""},this.discussFormErr={groupChecked:"",content:"",imageID:""},this.getPrepareDiscussList(),this.initUpload(),this.prepareVisible=!0,this.$store.commit("SET_FORBID_AUTO_NOTE",!0)},getPrepareDiscussList:function(){var t=this;this.prepareList=[],this.$mainHttp.prepareGroupSubject.dataList({CHID:this.$store.getters.classHourID}).then((function(e){e.Result?(e.Datas.sort((function(t,e){return t["CreateTime"]>e["CreateTime"]?-1:1})),e.Datas.forEach((function(e){t.prepareList.push({title:e["PGSContent"],createTime:Object(r["a"])(e["CreateTime"],"yyyy-MM-dd"),other:e["PGSTime"],id:e["PGSID"],checked:[]})}))):e.Info&&t.$toast(e.Info)})).catch((function(){}))},prepareSubmit:function(){var t=this;if(0!==this.prepareCheckeds.length){var e=[];this.loading=!0,this.prepareList.forEach((function(s){s.checked.length>0&&e.push(t.$mainHttp.groupDiscussion.postSetStart({groupID:s.checked.join(","),gsContent:s.title,gsForm:t.defaultType,ciID:t.$store.getters.courseID}))})),e.length>0&&d.a.all(e).then(d.a.spread((function(){for(var e=[],s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];o.forEach((function(t,s){t.Result||e.push(s)})),0===e.length?(t.$toast("新建讨论成功"),t.groupChanged(t.selectIndex),t.prepareVisible=!1,t.$store.commit("SET_FORBID_AUTO_NOTE",!1)):1===e.length&&e.length<o.length?(t.$toast("部分讨论未创建成功，请刷新重试"),t.groupChanged(t.selectIndex),t.prepareVisible=!1,t.$store.commit("SET_FORBID_AUTO_NOTE",!1)):t.$toast("操作失败！"),t.loading=!1}))).catch((function(){t.$toast("操作失败！"),t.loading=!1}))}else this.$toast("请给讨论课题指定小组")},toUpload:function(){Object(c["b"])(c["a"].albumOpen,"")},afterRead:function(t){var e=this;if(console.log("接收到的base64：",t),t.length>20971520)return this.$toast("请上传小于20M的图片"),!1;if(t){var s={funType:a["e"].GroupSubject,imgBaseString:t};this.$mainHttp.common.pictureUpload(s).then((function(t){t.Result&&(e.discussForm.imageID=t.Data)})).catch((function(){}))}},dropUpload:function(){this.discussForm.imageID=""},pictureSubmit:function(){var t=this;return this.discussFormErr={groupChecked:"",content:"",imageID:""},this.discussForm.groupChecked.length<=0?(this.$toast("请选择讨论小组!"),void(this.discussFormErr.groupChecked="请选择讨论小组")):this.discussForm.type===this.defaultType&&this.discussForm.content.length<=0?(this.$toast("请填写课题内容!"),void(this.discussFormErr.content="请填写课题内容")):this.discussForm.type!==this.defaultType&&this.discussForm.imageID.length<=0?(this.$toast("请上传课题图片!"),void(this.discussFormErr.content="请上传课题图片")):(this.loading=!0,void this.$mainHttp.groupDiscussion.postSetStart({groupID:this.discussForm.groupChecked.join(","),gsContent:this.discussForm.type===this.defaultType?this.discussForm.content:this.discussForm.imageID,gsForm:this.discussForm.type,ciID:this.$store.getters.courseID}).then((function(e){e.Result?(t.$toast("新建讨论成功"),t.groupChanged(t.selectIndex),t.prepareVisible=!1,t.$store.commit("SET_FORBID_AUTO_NOTE",!1)):e.Info?t.$toast(e.Info):t.$toast("新建讨论失败"),t.loading=!1})).catch((function(){t.$toast("操作失败"),t.loading=!1})))}},watch:{"$store.getters.groupDiscussion":function(t,e){if(t!==e)if(t.type===a["b"].newMsg){var s=t.value["groupID"],o=this.groupList.findIndex((function(t){return t.groupID===s}));o>-1?this.selectIndex===o&&this.getGroupDiscussList(this.groupList[o]):this.getGroupList()}else if(t.type===a["b"].good){var i=JSON.parse(t.value),n=i["groupID"],r=this.groupList.findIndex((function(t){return t.groupID===n}));if(r>-1){this.selectIndex=r;var c=this.groupList[r].discussList,u=c.findIndex((function(t){return t.id===i["gdID"]}));if(u>-1){var d=c[u];d.good=parseInt(i["gdGood"]),this.$set(c,u,d)}}else this.getGroupList()}else if(t.type===a["b"].score){var p=JSON.parse(t.value),l=p["groupID"],h=this.groupList.findIndex((function(t){return t.groupID===l}));if(h>-1){this.selectIndex=h;var g=this.groupList[h].discussList,m=g.findIndex((function(t){return t.id===p["gdID"]}));if(m>-1){var f=g[m];f.score=parseInt(p["gdScore"]),p["isAdd"]+""==="true"&&g.result.score++,p["isAdd"]+""==="false"&&g.result.score--,this.$set(g,m,f)}}else this.getGroupList()}}},beforeDestroy:function(){this.$store.commit("SET_FORBID_AUTO_NOTE",!1)}},l=p,h=(s("8456"),s("2877")),g=Object(h["a"])(l,o,i,!1,null,"5f1df2cd",null);e["default"]=g.exports},8456:function(t,e,s){"use strict";var o=s("0b20"),i=s.n(o);i.a},d81d:function(t,e,s){"use strict";var o=s("23e7"),i=s("b727").map,n=s("1dde"),a=s("ae40"),r=n("map"),c=a("map");o({target:"Array",proto:!0,forced:!r||!c},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);