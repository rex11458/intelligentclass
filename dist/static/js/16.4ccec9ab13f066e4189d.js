webpackJsonp([16],{"6XPT":function(t,e,s){"use strict";var i={name:"r-digit-input",props:{title:{type:String,default:""},subTitle:{type:String,default:""},codeLength:{type:Number,default:1},btnName:{type:String,default:"操作"},codeName:{type:String,default:"邀请码"}},data:function(){return{invitedLoading:!1,codeValue:"",isFocus:!1}},computed:{codeArr:function(){for(var t=[],e=(t=this.codeValue.split("")).length;e<this.codeLength;e++)t.push("");return t}},methods:{init:function(){var t=this;this.codeValue="",setTimeout(function(){t.$refs.topText.focus()},0)},onTextInput:function(t,e){this.codeArr.splice(t,1,e.data)},onInput:function(t){this.codeArr[t]&&t<this.codeLength-1&&this.$refs["ref"+(t+1)][0].focus()},onDelete:function(t){t>0&&this.$refs["ref"+(t-1)][0].focus()},textChange:function(){this.codeValue.length===this.codeLength&&this.submitCode()},submitCode:function(){this.codeArr.find(function(t){return!t})>-1?this.$toast("请输入"+this.codeName):this.$emit("submit",this.codeArr)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"r-digit"},[s("p",{staticClass:"digit-title"},[t._v(t._s(t.title))]),t._v(" "),s("p",{staticClass:"digit-remark"},[t._v(t._s(t.subTitle))]),t._v(" "),s("div",{staticClass:"digit-main"},[s("div",[s("van-field",{ref:"topText",staticClass:"digit-top",attrs:{type:"digit",maxlength:t.codeLength},on:{blur:function(e){t.isFocus=!1},focus:function(e){t.isFocus=!0},input:t.textChange},model:{value:t.codeValue,callback:function(e){t.codeValue=e},expression:"codeValue"}})],1),t._v(" "),s("div",{staticClass:"digit-input"},t._l(t.codeArr.length,function(e,i){return s("van-field",{key:i,class:["digit-text","len_"+t.codeArr.length,t.isFocus&&i===t.codeValue.length?"digit-focus":""],style:{width:"10vw",margin:"0 "+20/t.codeArr.length+"vw"},attrs:{type:"digit",disabled:"",maxlength:"1"},model:{value:t.codeArr[i],callback:function(e){t.$set(t.codeArr,i,e)},expression:"codeArr[index]"}})}),1)]),t._v(" "),s("div",{staticClass:"digit-operate"},[s("van-button",{staticClass:"digit-btn",attrs:{type:"primary",size:"small",loading:t.invitedLoading},on:{click:t.submitCode}},[t._v("\n      "+t._s(t.btnName)+"\n    ")])],1)])},staticRenderFns:[]},n=s("VU/8")(i,o,!1,null,null,null).exports;e.a=n},Ar9w:function(t,e){},Yp6c:function(t,e,s){"use strict";var i={name:"r-dropdown",data:function(){return{showMenu:!1,positionStyle:{top:"20px",left:"20px"}}},props:{selected:{}},created:function(){},mounted:function(){this.selectedOption=this.selected,document.addEventListener("click",this.hidePanel,!1)},destroyed:function(){document.removeEventListener("click",this.hidePanel,!1)},methods:{updateOption:function(t){this.selectedOption=t,this.$emit("updateOption",this.selectedOption)},toggleMenu:function(t){var e=this;this.showMenu=!this.showMenu;var s=document.body.clientWidth,i=document.body.clientHeight;setTimeout(function(){var t=e.$refs.downInfo.getBoundingClientRect(),o=e.$refs.downMenu.getBoundingClientRect(),n=0,r=0;n=t.width>=o.width?t.left+(t.width-o.width)/2:s-(t.left+(t.width-o.width)/2)>=o.width?t.left+(t.width-o.width)/2:s-o.width-5,r=o.height>=i-t.bottom+5?t.top-o.height+5:t.height+t.top-5,e.positionStyle={top:r+"px",left:n+"px"}},10)},closeBtnGroup:function(){this.showMenu=!1},hide:function(){var t=this;setTimeout(function(){t.showMenu=!1},150)},hidePanel:function(t){this.$refs.downMain.contains(t.target)||(this.showMenu=!1)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"downMain",staticClass:"r-dropdown"},[s("div",{ref:"downInfo",staticClass:"down-info",on:{click:function(e){return t.toggleMenu(e)}}},[t._t("default")],2),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showMenu,expression:"showMenu"}],ref:"downMenu",staticClass:"dropdown-menu",style:t.positionStyle},[t._t("menu")],2)])},staticRenderFns:[]},n=s("VU/8")(i,o,!1,null,null,null).exports;e.a=n},fxRH:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),o=s.n(i),n=s("pFYg"),r=s.n(n),a=s("Yp6c"),c=s("6XPT"),u={name:"",components:{},props:{courseType:{type:String,default:"current"},course:{type:Array,default:function(){return[]}}},data:function(){return{sites:[1,2,3]}},created:function(){},methods:{selectCourse:function(t){this.$store.commit("SET_COURSE",t),this.$store.commit("SET_COURSE_ID",t.CIID),"current"===this.courseType?this.$router.push("/course"):this.$router.push("/history")}},computed:{},watch:{}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"r-course-list"},[t.course.length>0?s("div",t._l(t.course,function(e,i){return s("div",{key:i,staticClass:"r-course-item"},[s("div",{staticClass:"flex-between head"},[s("div",{staticClass:"title"},[t._v(t._s(e.CHName))]),t._v(" "),"current"===t.courseType?s("van-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.selectCourse(e)}}},[t._v("\n          点击加入\n        ")]):"current"!==t.courseType?s("van-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return t.selectCourse(e)}}},[t._v("查看\n        ")]):t._e()],1),t._v(" "),s("div",{staticClass:"course-name"},[t._v("\n        【"+t._s(e.CourseName)+"】\n      ")]),t._v(" "),s("div",{staticClass:"info-line"},[s("div",{staticClass:"line-left"},[t._v("老师："+t._s(e.TeacherName))]),t._v(" "),s("div",{staticClass:"line-right"},[t._v("班级："+t._s(e.ClassName))])]),t._v(" "),s("div",{staticClass:"info-line"},[s("div",{staticClass:"line-left"},[t._v("教室："+t._s(e.ClassroomName))]),t._v(" "),s("div",{staticClass:"line-right"},[t._v("\n          时间：\n          "+t._s(t._f("formatDate")(e.CreateTime,e.CreateTime))+"\n        ")])]),t._v(" "),s("div",{staticClass:"line"})])}),0):t._e()])},staticRenderFns:[]},l=s("VU/8")(u,d,!1,null,null,null).exports,h=s("j/ZV"),f=s("0xDb"),m={name:"homeCourse",components:{RDropdown:a.a,RDigitInput:c.a,courseList:l},props:{},data:function(){return{headTopActive:0,nowDate:Object(f.f)(),currentCourse:{form:{startDate:Object(f.h)("date",-7),endDate:Object(f.f)(),stuid:this.$store.getters.studentID||"",psize:1,pno:0,estate:1},total:0,loading:!1,error:!1,finished:!1,data:[]},historyCourse:{form:{key:"",startDate:Object(f.h)("date",-365),endDate:Object(f.f)(),stuid:this.$store.getters.studentID||"",psize:10,pno:0,estate:2},total:0,loading:!1,error:!1,finished:!1,data:[]},isLoading:!1,invitedShow:!1,inviteCode:"",classRoomID:""}},beforeRouteEnter:function(t,e,s){s(function(t){e.path.indexOf("/history")>-1&&(t.headTopActive=1),t.$store.dispatch("ValidateCourse")})},created:function(){var t=this;window.acceptQRcode=function(e){console.log("接收扫码：",e);var s=t.isJsonString(e);return t.joinClass(s&&s.CIID?s.CIID:s,"scan"),!0}},mounted:function(){var t=this;this.$nextTick(function(){t.$store.getters.localIP||Object(h.b)(h.a.initLocalIP,"").then(function(e){e&&t.$store.commit("SET_IP",e)})})},methods:{isJsonString:function(t){try{if("object"===r()(JSON.parse(t)))return JSON.parse(t)}catch(t){}return t},scanOpen:function(){this.$refs.DropDown.hide(),Object(h.b)(h.a.openQRcode,"")},codeOpen:function(){var t=this;this.$refs.DropDown.hide(),this.invitedShow=!0,setTimeout(function(){t.$refs.digit.init()},0)},submitInvitedCode:function(t){this.joinClass(t.join(""),"code")},joinClass:function(t,e){var s=this;this.inviteCode="code"===e?t:"";var i={CIID:"scan"===e?t:"",studentID:this.$store.getters.studentID,studentName:this.$store.getters.student.StudentName,studentXH:this.$store.getters.userName,inviteCode:this.inviteCode};this.$store.dispatch("JoinClassByUser",i).then(function(t){t.Result?(s.classRoomID=t.ClassroomID,s.courseInfoGet()):t.Info?s.$toast(t.Info):s.$toast("邀请码不正确")}).catch(function(t){s.$toast("操作失败")})},courseInfoGet:function(){var t=this;this.$mainHttp.classInfo.dataInfo({ciID:this.$store.getters.courseID||""}).then(function(e){if(e.Result&&e.Datas&&e.Datas.length>0){var s=e.Datas[0],i={CHID:s.Key.CHID,CIID:s.Key.CIID,ClassID:s.Key.ClassID,ClassroomID:s.Key.ClassroomID,ClassroomName:s.ClsRoomName,TeacherID:s.Key.TeacherID,TeacherName:s.TeacherName,ClassName:s.ClassName,CHName:s.CHName,CourseName:s.CourseName,ClassDate:s.Key.ClassDate,CreateTime:s.Key.CreateTime};t.$store.commit("SET_COURSE",i),t.$store.commit("SET_COURSE_ID",s.Key.CIID),t.$store.commit("SET_NOW_COURSE",i),t.classRoomGet()}else e.Info?t.$toast(e.Info):t.$toast("获取课程信息失败")}).catch(function(){t.$toast("操作失败")})},classRoomGet:function(){var t=this;this.$store.dispatch("GetCourseServiceByUser",this.classRoomID).then(function(e){e.Result||e.Info&&t.$toast(e.Info),t.linkClassRoom()}).catch(function(){t.linkClassRoom()})},linkClassRoom:function(){var t=this,e={studentName:this.$store.getters.student.StudentName,studentXH:this.$store.getters.userName,studentID:this.$store.getters.studentID,CIID:this.$store.getters.courseID,inviteCode:this.inviteCode};this.$mainHttp.class.joinClass(e).then(function(e){e.Result?t.$router.push("/course"):e.Info?t.$toast(e.Info):(t.$toast("加入班级失败"),t.$store.commit("SET_NOW_COURSE",null))}).catch(function(){t.$store.commit("SET_NOW_COURSE",null),t.$toast("操作失败")})},currentStudentCourse:function(){var t=this,e=this.currentCourse;if(this.isLoading=!0,e.loading=!0,!(0===e.form.pno||e.total>e.form.pno*e.form.psize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.form.pno++,this.$mainHttp.classInfo.dataList(this.currentCourse.form).then(function(s){s.Result&&s.Datas&&s.Datas.length>0&&s.Datas.forEach(function(e){t.currentCourse.data.push(e)}),s.RowsCount&&(e.total=s.RowsCount),e.total>1&&(e.total=1),e.total<=e.form.pno*e.form.psize&&(e.finished=!0),e.loading=!1,t.isLoading=!1}).catch(function(s){e.error=!0,e.loading=!1,t.isLoading=!1})},historyStudentCourse:function(){var t=this,e=this.historyCourse;if(this.isLoading=!0,e.loading=!0,!(0===e.form.pno||e.total>e.form.pno*e.form.psize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.form.pno++,this.$mainHttp.classInfo.dataList(this.historyCourse.form).then(function(s){s.Result&&s.Datas&&s.Datas.length>0&&s.Datas.forEach(function(e){var s={CHID:e.Key.CHID,CIID:e.Key.CIID,ClassID:e.Key.ClassID,ClassroomID:e.Key.ClassroomID,ClassroomName:e.ClsRoomName,TeacherID:e.Key.TeacherID,TeacherName:e.TeacherName,ClassName:e.ClassName,CHName:e.CHName,CourseName:e.CourseName,ClassDate:e.Key.ClassDate,CreateTime:e.Key.CreateTime};t.historyCourse.data.find(function(t){return o()(t)===o()(s)})||t.historyCourse.data.push(s)}),s.RowsCount&&(e.total=s.RowsCount),e.total<=e.form.pno*e.form.psize&&(e.finished=!0),e.loading=!1,t.isLoading=!1}).catch(function(s){e.error=!0,e.loading=!1,t.isLoading=!1})},changeCourse:function(){if(0===this.headTopActive){this.currentCourse.form.pno=0,this.currentCourse.total=0,this.currentCourse.error=!1,this.currentCourse.finished=!1,this.currentCourse.data=[];var t=this.currentCourse;t.finished=!0,t.loading=!1,this.isLoading=!1}else this.historyCourse.form.pno=0,this.historyCourse.total=0,this.historyCourse.error=!1,this.historyCourse.finished=!1,this.historyCourse.data=[],this.historyStudentCourse()}}},C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"home-course"}},[s("head-top",{attrs:{title:"课程","show-back":!1}},[s("r-dropdown",{ref:"DropDown",staticClass:"head-right",attrs:{slot:"right"},slot:"right"},[s("van-icon",{ref:"Scan",attrs:{name:"scan"}}),t._v(" "),s("div",{attrs:{slot:"menu"},slot:"menu"},[s("div",{staticClass:"head_menu_item",on:{click:t.scanOpen}},[t._v("扫一扫")]),t._v(" "),s("div",{staticClass:"head_menu_item",on:{click:t.codeOpen}},[t._v("邀请码")])])],1)],1),t._v(" "),s("van-tabs",{on:{change:t.changeCourse},model:{value:t.headTopActive,callback:function(e){t.headTopActive=e},expression:"headTopActive"}},[s("van-tab",{attrs:{title:"正在上课"}},[t.$store.getters.nowCourse?s("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.changeCourse},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[s("course-list",{staticClass:"list_card",attrs:{"course-type":"current",course:[t.$store.getters.nowCourse]}})],1):s("div",{staticClass:"list_remark"},[t._v("\n        请点击右上角的\n        "),s("van-icon",{style:{fontSize:"18px",color:"#fff",background:"#00cbab"},attrs:{name:"scan"}}),t._v(" "),s("div",[t._v("选择 扫一扫 或 邀请码 加入课程")])],1)],1),t._v(" "),s("van-tab",{attrs:{title:"历史课程"}},[s("van-pull-refresh",{staticClass:"pull_fresh",attrs:{"head-height":80},on:{refresh:t.changeCourse},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[s("van-list",{attrs:{finished:t.historyCourse.finished,"finished-text":"没有更多了",error:t.historyCourse.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){return t.$set(t.historyCourse,"error",e)},load:t.historyStudentCourse},model:{value:t.historyCourse.loading,callback:function(e){t.$set(t.historyCourse,"loading",e)},expression:"historyCourse.loading"}},[s("course-list",{staticClass:"list_card",attrs:{"course-type":"history",course:t.historyCourse.data}})],1)],1)],1)],1),t._v(" "),s("van-popup",{model:{value:t.invitedShow,callback:function(e){t.invitedShow=e},expression:"invitedShow"}},[s("r-digit-input",{ref:"digit",attrs:{title:"请输入邀请码","sub-title":"请在下方输入邀请码加入班级","code-length":6,"btn-name":"加入班级","code-name":"邀请码"},on:{submit:t.submitInvitedCode}})],1)],1)},staticRenderFns:[]};var p=s("VU/8")(m,C,!1,function(t){s("Ar9w")},null,null);e.default=p.exports}});
//# sourceMappingURL=16.4ccec9ab13f066e4189d.js.map