webpackJsonp([15],{"6XPT":function(t,e,i){"use strict";var n={name:"r-digit-input",props:{title:{type:String,default:""},subTitle:{type:String,default:""},codeLength:{type:Number,default:1},btnName:{type:String,default:"操作"},codeName:{type:String,default:"邀请码"}},data:function(){return{invitedLoading:!1,codeValue:"",isFocus:!1}},computed:{codeArr:function(){for(var t=[],e=(t=this.codeValue.split("")).length;e<this.codeLength;e++)t.push("");return t}},methods:{init:function(){var t=this;this.codeValue="",setTimeout(function(){t.$refs.topText.focus()},0)},onTextInput:function(t,e){this.codeArr.splice(t,1,e.data)},onInput:function(t){this.codeArr[t]&&t<this.codeLength-1&&this.$refs["ref"+(t+1)][0].focus()},onDelete:function(t){t>0&&this.$refs["ref"+(t-1)][0].focus()},textChange:function(){this.codeValue.length===this.codeLength&&this.submitCode()},submitCode:function(){this.codeArr.find(function(t){return!t})>-1?this.$toast("请输入"+this.codeName):this.$emit("submit",this.codeArr)}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"r-digit"},[i("p",{staticClass:"digit-title"},[t._v(t._s(t.title))]),t._v(" "),i("p",{staticClass:"digit-remark"},[t._v(t._s(t.subTitle))]),t._v(" "),i("div",{staticClass:"digit-main"},[i("div",[i("van-field",{ref:"topText",staticClass:"digit-top",attrs:{type:"digit",maxlength:t.codeLength},on:{blur:function(e){t.isFocus=!1},focus:function(e){t.isFocus=!0},input:t.textChange},model:{value:t.codeValue,callback:function(e){t.codeValue=e},expression:"codeValue"}})],1),t._v(" "),i("div",{staticClass:"digit-input"},t._l(t.codeArr.length,function(e,n){return i("van-field",{key:n,class:["digit-text","len_"+t.codeArr.length,t.isFocus&&n===t.codeValue.length?"digit-focus":""],style:{width:"10vw",margin:"0 "+20/t.codeArr.length+"vw"},attrs:{type:"digit",disabled:"",maxlength:"1"},model:{value:t.codeArr[n],callback:function(e){t.$set(t.codeArr,n,e)},expression:"codeArr[index]"}})}),1)]),t._v(" "),i("div",{staticClass:"digit-operate"},[i("van-button",{staticClass:"digit-btn",attrs:{type:"primary",size:"small",loading:t.invitedLoading},on:{click:t.submitCode}},[t._v("\n      "+t._s(t.btnName)+"\n    ")])],1)])},staticRenderFns:[]},o=i("VU/8")(n,s,!1,null,null,null).exports;e.a=o},Bdsp:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mvHQ"),s=i.n(n),o=i("pFYg"),a=i.n(o),c=i("Yp6c"),r=i("6XPT"),d=i("j/ZV"),u={name:"",components:{RDropdown:c.a,RDigitInput:r.a},props:{},data:function(){return{state:"尚未签到",nowDateTime:"",course:this.$store.getters.course,signModel:1,signState:0,signList:[],signShow:!1,signCode:["","","",""],signLoading:!1}},created:function(){var t=this;window.acceptQRcode=function(e){console.log("接收签到码：",e);var i=t.isJsonString(e);return t.qrCodeSign(i&&i.CIID?i.CIID+","+i.SignCode:i,"scan"),!0},this.getSignWay()},mounted:function(){},methods:{isJsonString:function(t){try{if("object"===a()(JSON.parse(t)))return JSON.parse(t)}catch(t){}return t},scanOpen:function(){this.$refs.DropDown.hide(),Object(d.b)(d.a.openQRcode,"")},codeOpen:function(){var t=this;this.$refs.DropDown.hide(),this.signCode=["","","",""],this.signShow=!0,setTimeout(function(){t.$refs.digit.init()},0)},submitSignCode:function(t){this.qrCodeSign(t.join(""),"code")},getSignWay:function(){var t=this;this.signList=[],this.$mainHttp.sign.dataList({ciID:this.$store.getters.courseID,studentID:this.$store.getters.studentID}).then(function(e){e.Datas&&e.Datas.length>0&&e.Datas.forEach(function(e){t.signList.push(e)}),e.SignModel?(t.signModel=e.SignModel,t.signState=e.Result?1:0,t.autoSign()):(t.state="签到失败",t.$toast("获取签到状态失败~"))}).catch(function(){t.state="签到失败",t.$toast("获取签到状态异常~")})},autoSign:function(){1===this.signState?this.state="已签到":1===this.signModel&&this.qrCodeSign("")},qrCodeSign:function(t,e){var i=this;this.state="签到中...";var n="string"==typeof t?t:s()(t),o={ciID:this.$store.getters.courseID,studentID:this.$store.getters.studentID,qrCodeStr:"",signCode:""};"scan"===e?o.qrCodeStr=n:"code"===e&&(o.signCode=n),this.$mainHttp.sign.postSign(o).then(function(t){t.Result?(i.signState=1,i.state="签到成功",i.signShow=!1,i.$toast("签到成功"),i.getSignWay()):(i.state=t.Info?t.Info:"签到失败",t.Info&&i.$toast(t.Info))}).catch(function(){i.state="操作失败"})},getSignList:function(){}},computed:{},watch:{}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"sign-in"}},[i("head-top",{attrs:{title:"签到"}},[1!==t.signState&&1!==t.signModel?i("r-dropdown",{ref:"DropDown",staticClass:"head-right",attrs:{slot:"right"},slot:"right"},[i("van-icon",{ref:"Scan",attrs:{name:"scan"}}),t._v(" "),i("div",{attrs:{slot:"menu"},slot:"menu"},[i("div",{staticClass:"head_menu_item",on:{click:t.scanOpen}},[t._v("扫一扫")]),t._v(" "),i("div",{staticClass:"head_menu_item",on:{click:t.codeOpen}},[t._v("签到码")])])],1):t._e()],1),t._v(" "),i("div",{staticClass:"bg"}),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"success-info"},[t._v(t._s(t.$store.getters.student.StudentName+"，"+t.state))]),t._v(" "),i("div",{staticClass:"title"},[t._v(t._s(t.course.CourseName))]),t._v(" "),i("div",{staticClass:"line-info"},[i("span",[t._v("老师："+t._s(t.course.TeacherName))]),t._v(" "),i("span",[t._v("班级："+t._s(t.course.ClassName))])]),t._v(" "),i("div",{staticClass:"line-info"},[i("span",[t._v("教室："+t._s(t.course.ClassroomName))]),t._v(" "),i("span",[t._v("\n        时间：\n        "+t._s(t._f("formatDate")(t.course.CreateTime,t.course.CreateTime))+"\n      ")])])]),t._v(" "),1===t.signList.length?i("div",{staticClass:"sign_info"},[i("van-tag",{attrs:{plain:"",type:"primary",size:"large"}},[t._v("\n      签到时间：\n      "+t._s(t._f("formatDate")(t.signList[0].Key.SignTime,t.signList[0].Key.SignTime))+"\n    ")])],1):t.signList.length>1?i("div",{staticClass:"sign_info"},[i("div",{staticClass:"sign_item"},t._l(t.signList,function(e,n){return i("van-tag",{key:n,staticStyle:{"margin-bottom":"3vw"},attrs:{plain:"",type:"success",size:"large"}},[t._v("\n        第"+t._s(e.SignNumber)+"次签到:\n        "+t._s(t._f("formatDate")(e.Key.SignTime,e.Key.SignTime))+"\n      ")])}),1)]):t._e(),t._v(" "),i("van-popup",{model:{value:t.signShow,callback:function(e){t.signShow=e},expression:"signShow"}},[i("r-digit-input",{ref:"digit",attrs:{title:"请在下方输入签到码进行签到","code-length":4,"btn-name":"签到","code-name":"签到码"},on:{submit:t.submitSignCode}})],1)],1)},staticRenderFns:[]};var g=i("VU/8")(u,l,!1,function(t){i("WSPE")},"data-v-f4b7ab3a",null);e.default=g.exports},WSPE:function(t,e){},Yp6c:function(t,e,i){"use strict";var n={name:"r-dropdown",data:function(){return{showMenu:!1,positionStyle:{top:"20px",left:"20px"}}},props:{selected:{}},created:function(){},mounted:function(){this.selectedOption=this.selected,document.addEventListener("click",this.hidePanel,!1)},destroyed:function(){document.removeEventListener("click",this.hidePanel,!1)},methods:{updateOption:function(t){this.selectedOption=t,this.$emit("updateOption",this.selectedOption)},toggleMenu:function(t){var e=this;this.showMenu=!this.showMenu;var i=document.body.clientWidth,n=document.body.clientHeight;setTimeout(function(){var t=e.$refs.downInfo.getBoundingClientRect(),s=e.$refs.downMenu.getBoundingClientRect(),o=0,a=0;o=t.width>=s.width?t.left+(t.width-s.width)/2:i-(t.left+(t.width-s.width)/2)>=s.width?t.left+(t.width-s.width)/2:i-s.width-5,a=s.height>=n-t.bottom+5?t.top-s.height+5:t.height+t.top-5,e.positionStyle={top:a+"px",left:o+"px"}},10)},closeBtnGroup:function(){this.showMenu=!1},hide:function(){var t=this;setTimeout(function(){t.showMenu=!1},150)},hidePanel:function(t){this.$refs.downMain.contains(t.target)||(this.showMenu=!1)}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"downMain",staticClass:"r-dropdown"},[i("div",{ref:"downInfo",staticClass:"down-info",on:{click:function(e){return t.toggleMenu(e)}}},[t._t("default")],2),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showMenu,expression:"showMenu"}],ref:"downMenu",staticClass:"dropdown-menu",style:t.positionStyle},[t._t("menu")],2)])},staticRenderFns:[]},o=i("VU/8")(n,s,!1,null,null,null).exports;e.a=o}});
//# sourceMappingURL=15.dc90df6384b35de2f940.js.map