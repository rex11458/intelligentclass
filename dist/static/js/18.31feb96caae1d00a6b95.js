webpackJsonp([18],{"/EMt":function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});e("WJbf");var n=e("OhwO"),i=e("wH5m"),o=e("XhFK"),a=e.n(o),c=e("FwVa"),u=e("j/ZV"),r={name:"",components:{RImage:i.a},props:{},data:function(){return{total:0,contentType:c.b.Text,contentTypeDefault:c.b.Text,content:"",imgBase:"",defaultPhotoImg:a.a,groupName:this.$store.getters.group&&this.$store.getters.group.groupName||"暂无组名",showEdit:!1,imagePreview:null,discussionSubject:null,discussionContents:[]}},computed:{score:function(){var t=0;return this.discussionContents.forEach(function(s){t+=s.GDScore}),t},good:function(){var t=0;return this.discussionContents.forEach(function(s){t+=s.GDGood?1:0}),t}},created:function(){this.getDataStatics(),this.getDataDetail()},mounted:function(){var t=this;this.$nextTick(function(){window.uploadImage=function(s){t.afterRead(s)}})},methods:{preview:function(t){this.imagePreview=Object(n.a)({images:[t],showIndex:!1,onClose:function(){}})},getDataStatics:function(){var t=this;this.$gatewayHttp.groupDiscussion.getStatistic({groupID:this.$store.getters.groupID}).then(function(s){s.Result&&(t.total=s.Total||0)}).catch(function(t){})},getDataDetail:function(){var t=this;this.$gatewayHttp.groupDiscussion.getList({groupID:this.$store.getters.groupID}).then(function(s){s.Result&&s.Datas&&s.Datas.length>0&&(t.discussionSubject=s.Datas[0].Key,s.Datas[0].Value.sort(function(t,s){return t.SubmitTime<s.SubmitTime?-1:1}),s.Datas[0].Value.forEach(function(s){var e=t.discussionContents.findIndex(function(t){return t.GDID===s.GDID});-1===e?(t.discussionContents.push(s),t.$nextTick(function(){console.log(t.$refs.chat.scrollHeight,t.$refs.chat.scrollTop),t.$refs.chat.scrollTop=t.$refs.chat.scrollHeight,setTimeout(function(){t.$refs.chat.scrollTop=t.$refs.chat.scrollHeight},1e3)})):t.discussionContents.splice(e,1,s)}))}).catch(function(t){})},dataAdd:function(){var t=this;this.content&&this.$gatewayHttp.groupDiscussion.postDataSave({gsid:this.discussionSubject.GSID,studentID:this.$store.getters.studentID,groupID:this.$store.getters.groupID,gdForm:this.contentType,gdContent:this.content}).then(function(s){s.Result?(t.content="",t.contentType=t.contentTypeDefault):s.Info&&t.$toast(s.Info)}).catch(function(t){})},getDiscussionImage:function(t){return this.$gatewayHttp.resourse.picture(t,c.h.GroupSubject)},getImageFile:function(t){return this.$gatewayHttp.resourse.picture(t,c.h.GroupDiscuss)},selectPhoto:function(t){this.discussionSubject&&(2===t?Object(u.b)(u.a.cameraOpen,""):Object(u.b)(u.a.albumOpen,""))},afterRead:function(t){var s=this;if(console.log("接收到的base64：",t),t.length>20971520)return this.$toast("请上传小于20M的图片"),!1;if(t){var e={funType:c.h.GroupDiscuss,imgBaseString:t};this.$gatewayHttp.resourse.upload(e).then(function(e){e.Result&&(s.contentType=c.b.Picture,s.imgBase=t,s.content=e.Data,s.dataAdd())}).catch(function(t){})}}},watch:{"$store.getters.groupDiscussion":function(t,s){t!==s&&(t.type===c.c.init?(this.getDataStatics(),this.getDataDetail(),this.discussionSubject=null,this.discussionContents=[]):t.type===c.c.newMsg?this.getDataDetail():t.type===c.c.good?this.getDataDetail():t.type===c.c.score&&this.getDataDetail())},discussionContents:function(t,s){var e=this;t.length!==s.length&&this.$nextTick(function(){e.$refs.chat.scrollTop=e.$refs.chat.scrollHeight,setTimeout(function(){e.$refs.chat.scrollTop=e.$refs.chat.scrollHeight},1e3)})}},beforeDestroy:function(){this.imagePreview&&this.imagePreview.close()}},l={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"group-discussion"}},[e("head-top",{attrs:{title:t.groupName}},[e("router-link",{staticClass:"head-right",attrs:{to:"/teamRank"}},[e("i",{staticClass:"iconfont icon-chengyuan"})])],1),t._v(" "),e("div",{staticClass:"summary"},[e("div",[t._v("\n      论题:\n      "),e("span",[t._v(t._s(t.total))])]),t._v(" "),e("div",[t._v("\n      得分数:\n      "),e("span",[t._v(t._s(t.score))])]),t._v(" "),e("div",[t._v("\n      点赞数:\n      "),e("span",[t._v(t._s(t.good))])])]),t._v(" "),e("div",{ref:"chat",staticClass:"chat"},[t.discussionSubject?e("div",{staticClass:"chat_title"},[e("span",{staticClass:"chat_title_left"},[t._v("[论题]")]),t._v(" "),t.discussionSubject.GSForm===t.contentTypeDefault?e("span",[t._v(t._s(t.discussionSubject.GSContent))]):e("img",{style:{maxWidth:"70vw",maxHeight:"15rem"},attrs:{alt:"",src:t.getDiscussionImage(t.discussionSubject.GSContent)},on:{click:function(s){t.preview(t.getDiscussionImage(t.discussionSubject.GSContent))}}})]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.discussionContents&&t.discussionContents.length>0,expression:"discussionContents && discussionContents.length > 0"}],staticClass:"chat_content"},t._l(t.discussionContents,function(s,n){return e("div",{key:n,class:s.StudentID!==t.$store.getters.studentID?"chat_item left_item":"chat_item right_item"},[e("div",{staticClass:"chat_icon"},[e("img",{attrs:{src:t.defaultPhotoImg,alt:""}})]),t._v(" "),e("div",{staticClass:"chat_news"},[e("div",{staticClass:"chat_news_name"},[t._v(t._s(s.StudentName))]),t._v(" "),e("div",{staticClass:"chat_news_cont"},[s.GDForm===t.contentTypeDefault?e("span",[t._v(t._s(s.GDContent))]):e("img",{attrs:{src:t.getImageFile(s.GDContent),alt:""},on:{click:function(e){t.preview(t.getImageFile(s.GDContent))}}}),t._v(" "),e("div",{staticClass:"chat_news_arrow"})])])])}),0)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.discussionSubject,expression:"discussionSubject"}],staticClass:"footer"},[e("div",{staticClass:"footer_text"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{type:"text",disabled:!t.discussionSubject,placeholder:"请输入讨论内容"},domProps:{value:t.content},on:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.dataAdd(s)},input:function(s){s.target.composing||(t.content=s.target.value)}}})]),t._v(" "),0===t.content.length?e("div",{staticClass:"icons"},[e("i",{staticClass:"iconfont icon-tupian",attrs:{disabled:!t.discussionSubject},on:{click:function(s){return t.selectPhoto(1)}}}),t._v(" "),e("i",{staticClass:"iconfont icon-photograph",attrs:{disabled:!t.discussionSubject},on:{click:function(s){return t.selectPhoto(2)}}})]):e("div",{staticClass:"icons"},[e("van-button",{attrs:{size:"small",type:"primary"},on:{click:t.dataAdd}},[t._v("发送")])],1)])],1)},staticRenderFns:[]};var h=e("VU/8")(r,l,!1,function(t){e("Shrz")},"data-v-72cdd0e0",null);s.default=h.exports},Shrz:function(t,s){},wH5m:function(t,s,e){"use strict";var n=e("SVYa");s.a=n.a}});
//# sourceMappingURL=18.31feb96caae1d00a6b95.js.map