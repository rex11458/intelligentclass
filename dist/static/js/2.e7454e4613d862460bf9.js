webpackJsonp([2],{"+u6F":function(i,t){},"3xbx":function(i,t){},A1eh:function(i,t){},OfTL:function(i,t){i.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTY4MjgxNDU1MDQ1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQzODMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRBNTEyIDUxMiAwIDEgMSA1MTIgMGE1MTIgNTEyIDAgMCAxIDAgMTAyNHpNMzgzLjIzMiAyODcuNjE2djQ0OGwzODQtMjIzLjEwNC0zODQtMjI0Ljg5NnoiIGZpbGw9InJnYmEoMjU1LCAyNTUsIDI1NSwwLjgpIiBwLWlkPSI0Mzg0Ij48L3BhdGg+PC9zdmc+"},aw7r:function(i,t){i.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTY4MjgxODY4MjQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjUwMjMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRBNTEyIDUxMiAwIDEgMSA1MTIgMGE1MTIgNTEyIDAgMCAxIDAgMTAyNHpNMzIwIDMyMHYzODRoMTI4VjMyMEgzMjB6IG0yNTYgMHYzODRoMTI4VjMyMEg1NzZ6IiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsMC44KSIgcC1pZD0iNTAyNCI+PC9wYXRoPjwvc3ZnPg=="},bPoL:function(i,t){},eQnu:function(i,t){i.exports="data:image/png;base64,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"},m1Wi:function(i,t){i.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTY4MjgyMDEzMjI4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjU4MjUiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTExLjUgNTE0bS00NDcgMGE0NDcgNDQ3IDAgMSAwIDg5NCAwIDQ0NyA0NDcgMCAxIDAtODk0IDBaIiBmaWxsPSIjZmZmIiBwLWlkPSI1ODI2Ij48L3BhdGg+PC9zdmc+"},nA8i:function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={name:"",components:{RFilePreview:e("pB1M").a},data:function(){return{id:this.$route.params.id,fileExt:this.$route.params.fileExt,name:this.$route.params.name}}},s={render:function(){var i=this.$createElement,t=this._self._c||i;return t("div",{attrs:{id:"CoursewareView"}},[t("head-top",{attrs:{title:"文件预览"}}),this._v(" "),t("r-file-preview",{attrs:{"file-ext":this.fileExt,"file-name":this.name,"file-id":this.id}})],1)},staticRenderFns:[]};var n=e("VU/8")(a,s,!1,function(i){e("+u6F")},"data-v-08b3713a",null);t.default=n.exports},pB1M:function(i,t,e){"use strict";var a=e("bOdI"),s=e.n(a),n=(e("WJbf"),e("OhwO")),o={name:"imageView",props:{fileId:{type:String,required:!0},fileExt:{type:String,required:!0},index:{type:Number,default:1},fileTotal:{type:Number,default:0},autoLoad:{type:Boolean,default:!1}},data:function(){return{isLoad:!1,loading:!1,loadFail:!1,file:null}},computed:{indexShow:function(){return-1===["bmp","gif","jpg","png","ico"].indexOf(this.fileExt)}},mounted:function(){this.autoLoad&&this.init()},methods:{init:function(){var i=this;this.loading||this.isLoad||(this.loading=!0,this.$mainHttp.common.viewFile({mid:this.fileId,suffix:this.fileExt,index:this.index}).then(function(t){for(var e=new Uint8Array(t),a="",s=0;s<e.byteLength;s++)a+=String.fromCharCode(e[s]);switch(i.fileExt){case"png":i.file="data:image/png;base64,"+window.btoa(a);break;case"gif":i.file="data:image/gif;base64,"+window.btoa(a);break;case"x-icon":i.file="data:image/x-icon;base64,"+window.btoa(a);break;default:i.file="data:image/jpeg;base64,"+window.btoa(a)}i.loading=!1,i.isLoad=!0,setTimeout(function(){i.loadFail||i.$emit("finish",i.index)})}).catch(function(){i.loading=!1,i.loadFail||i.$emit("finish",i.index),i.loadFail=!0}))},view:function(){this.loadFail||this.$emit("preview",this.file)}}},r={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{ref:"img",staticClass:"image-view"},[e("img",{ref:"image",staticStyle:{"object-fit":"fill"},attrs:{src:i.file,alt:"",width:"100%"},on:{click:i.view}}),i._v(" "),i.loadFail?e("div",{on:{click:function(t){return t.stopPropagation(),t.preventDefault(),i.init(t)}}},[i._v("加载失败，点击重新加载")]):i._e(),i._v(" "),i.indexShow&&(i.loadFail||i.isLoad)?e("div",{staticClass:"remark"},[i._v(i._s(i.index))]):i._e()])},staticRenderFns:[]};var l=e("VU/8")(o,r,!1,function(i){e("3xbx")},"data-v-4b00d5f3",null).exports,d=function(i){return(i=Math.floor(i))<10?"0"+i:i+""},c=function(i){var t;return i-=60*(t=Math.floor(i/60)),d(t)+":"+d(i)},h={name:"r-video",props:{src:{type:String,required:!0},poster:{type:String,default:""},showVideo:{type:Boolean,default:!0},autoPlay:{type:Boolean,default:!0}},data:function(){return{defaultPost:e("Rh6y"),mediaSrc:"",mediaPoster:"",$video:null,player:{$player:null,pos:null},progressBar:{$progress:null,pos:null},video:{loaded:0,displayTime:"00:00",totalTime:"00:00",progress:{width:0,current:0}},hideTimer:null,state:{controlBtnShow:!0,controlBarShow:!1,fullScreen:!1,playing:!1,isLoading:!1,isEnd:!1,isError:!1},isFirstTouch:!0,isPauseTouch:!1}},mounted:function(){var i=this;this.$nextTick(function(){i.init()})},methods:{init:function(){this.mediaSrc=this.src,this.mediaPoster=this.poster,this.$video=this.$el.getElementsByTagName("video")[0],this.initPlayer()},initParam:function(i,t){this.mediaSrc=i,this.mediaPoster=t,this.state.isError=!1,this.$video=this.$el.getElementsByTagName("video")[0],this.initPlayer()},initPlayer:function(){var i=this.$el,t=this.$el.getElementsByClassName("progress")[0];this.player.$player=i,this.progressBar.$progress=t,this.player.pos=i.getBoundingClientRect(),this.progressBar.pos=t.getBoundingClientRect(),this.video.progress.width=Math.round(t.getBoundingClientRect().width)},clickPlayBtn:function(){var i=this;if(!this.state.isLoading&&(this.initPlayer(),this.isFirstTouch=!1,this.state.playing=!this.state.playing,this.state.isEnd=!1,this.$video))if(this.state.playing)try{this.$video.play(),this.$emit("selectChange"),this.isPauseTouch=!1,this.$video.addEventListener("progress",function(t){i.getLoadTime()}),this.$video.addEventListener("timeupdate",function(i,t,e){if(1===e)var a=0;else if(2===e)var s;return function(){var n=this,o=arguments;if(1===e){var r=Date.now();r-a>t&&(i.apply(n,o),a=r)}else 2===e&&(s||(s=setTimeout(function(){s=null,i.apply(n,o)},t)))}}(this.getPlayTime,100,1)),this.$video.addEventListener("ended",function(t){i.state.playing=!1,i.state.isEnd=!0,i.state.controlBtnShow=!0,i.video.displayTime="00:00",i.video.progress.current=0,i.$video.currentTime=0})}catch(i){}else this.isPauseTouch=!0,this.$video.pause()},stopPlay:function(){this.$video.load(),this.state.playing=!1,this.init()},touchEnterVideo:function(){this.isFirstTouch||(this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null),this.state.controlBtnShow=!0,this.state.controlBarShow=!0)},touchLeaveVideo:function(){var i=this;this.isFirstTouch||(this.hideTimer&&clearTimeout(this.hideTimer),this.isPauseTouch?(this.state.controlBtnShow=!0,this.state.controlBarShow=!0):this.hideTimer=setTimeout(function(){i.state.controlBarShow=!1,i.state.isLoading?i.state.controlBtnShow=!0:i.state.controlBtnShow=!1,i.hideTimer=null},3e3))},handleWaiting:function(){this.state.controlBtnShow=!0,this.state.isLoading=!0},handleError:function(){this.mediaSrc&&(this.state.isError=!0)},retry:function(){this.state.isError=!1,this.$video.load()},getPlayTime:function(){var i=this.$video.currentTime/this.$video.duration;this.video.progress.current=Math.round(this.video.progress.width*i),this.video.totalTime=c(this.$video.duration),this.video.displayTime=c(this.$video.currentTime)},getLoadTime:function(){this.video.loaded=this.$video.buffered.end(0)/this.$video.duration*100},moveStart:function(i){},moveIng:function(i){var t=i.targetTouches[0].pageX-this.progressBar.pos.left;t<=0&&(t=0),t>=this.video.progress.width&&(t=this.video.progress.width),this.video.progress.current=t;var e=this.video.progress.current/this.video.progress.width;this.$video.duration&&this.setPlayTime(e,this.$video.duration)},moveEnd:function(i){var t=i.changedTouches[0].pageX-this.progressBar.pos.left;this.video.progress.current=t;var e=t/this.video.progress.width;this.$video.duration&&this.setPlayTime(e,this.$video.duration)},setPlayTime:function(i,t){this.$video.currentTime=Math.floor(i*t)},fullScreen:function(){console.log("点击全屏..."),this.state.fullScreen?(this.state.fullScreen=!1,document.webkitCancelFullScreen()):(this.state.fullScreen=!0,this.$video.webkitRequestFullScreen())}},beforeDestroy:function(){}},u={render:function(){var i=this,t=i.$createElement,a=i._self._c||t;return a("div",{staticClass:"r-video"},[i.showVideo?a("video",{ref:"video",staticStyle:{"object-fit":"fill"},attrs:{"webkit-playsinline":"true",playsinline:"true","x-webkit-airplay":"true","x5-video-player-type":"h5","x5-video-player-fullscreen":"true","x5-video-orientation":"landscape",controlslist:"nodownload",preload:"false",poster:i.mediaPoster,src:i.mediaSrc},on:{waiting:i.handleWaiting,canplaythrough:function(t){i.state.isLoading=!1},playing:function(t){i.state.isLoading=!1,i.state.controlBtnShow=!1,i.state.playing=!0},stalled:function(t){i.state.isLoading=!0},error:i.handleError}},[i._v("\n    您的浏览器不支持HTML5\n  ")]):i._e(),i._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:!i.showVideo||i.state.isEnd,expression:"!showVideo || state.isEnd"}],staticClass:"poster",attrs:{src:i.mediaPoster,onerror:"onerror=null;src='"+i.defaultPost+"'",alt:""}}),i._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!i.state.isError,expression:"!state.isError"}],ref:"control",staticClass:"control",on:{touchstart:i.touchEnterVideo,touchend:i.touchLeaveVideo}},[a("div",{directives:[{name:"show",rawName:"v-show",value:i.state.controlBtnShow,expression:"state.controlBtnShow"}],staticClass:"play",on:{touchstart:function(t){return t.stopPropagation(),i.clickPlayBtn(t)}}},[a("img",{directives:[{name:"show",rawName:"v-show",value:!i.state.playing&&!i.state.isLoading,expression:"!state.playing && !state.isLoading"}],attrs:{src:e("OfTL"),alt:""}}),i._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:i.state.playing&&!i.state.isLoading,expression:"state.playing  && !state.isLoading"}],attrs:{src:e("aw7r"),alt:""}}),i._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:i.state.isLoading,expression:"state.isLoading"}],staticClass:"loader"},[i._m(0)])]),i._v(" "),a("div",{staticClass:"control-bar",style:{visibility:i.state.controlBarShow?"visible":"hidden"}},[a("span",{staticClass:"time"},[i._v(i._s(i.video.displayTime))]),i._v(" "),a("span",{ref:"progress",staticClass:"progress"},[a("img",{staticClass:"progress-btn ignore",style:{transform:"translate3d("+i.video.progress.current+"px, 0, 0)"},attrs:{src:e("m1Wi"),alt:""}}),i._v(" "),a("span",{staticClass:"progress-loaded",style:{width:i.video.loaded+"%"}}),i._v(" "),a("span",{staticClass:"progress-move",on:{touchmove:function(t){return t.stopPropagation(),t.preventDefault(),i.moveIng(t)},touchstart:function(t){return t.stopPropagation(),i.moveStart(t)},touchend:function(t){return t.stopPropagation(),i.moveEnd(t)}}})]),i._v(" "),a("span",{staticClass:"total-time"},[i._v(i._s(i.video.totalTime))]),i._v(" "),a("span",{staticClass:"full-screen",on:{click:i.fullScreen}},[a("img",{attrs:{src:e("wxj2"),alt:""}})])])]),i._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:i.state.isError,expression:"state.isError"}],staticClass:"error"},[a("p",{staticClass:"lose"},[i._v("视频加载失败")]),i._v(" "),a("p",{staticClass:"retry",on:{click:i.retry}},[i._v("点击重试")])])])},staticRenderFns:[function(){var i=this.$createElement,t=this._self._c||i;return t("div",{staticClass:"loader-inner ball-clip-rotate"},[t("div")])}]},v=e("VU/8")(h,u,!1,null,null,null).exports,f=e("eQnu"),m=e.n(f),g={name:"VideoView",components:{tVideo:v},props:{fileId:{type:String,required:!0}},data:function(){return{mediaPoster:m.a,isLoad:!1,loading:!1,loadFail:!1,file:null}},computed:{mediaSrc:function(){return this.$mainHttp.common.file(this.fileId)}},mounted:function(){},methods:{}},I={render:function(){var i=this.$createElement,t=this._self._c||i;return t("div",{ref:"img",staticClass:"video-view"},[t("t-video",{attrs:{src:this.mediaSrc,poster:this.mediaPoster}})],1)},staticRenderFns:[]};var p=e("VU/8")(g,I,!1,function(i){e("bPoL")},"data-v-224ea6e9",null).exports,M={name:"r-file-view",components:s()({ImageView:l,VideoView:p},n.a.Component.name,n.a.Component),props:{fileId:{type:String,required:!0},fileName:{type:String,required:!0},fileExt:{type:String,required:!0},fileTotal:{type:Number,default:0}},data:function(){return{canOpenFileExt:["txt","bmp","gif","jpg","png","ico"],txtContent:"",loadIndex:1,finishedHeight:0,canLoad:!0,active:1,viewTotal:1,allFinished:!1,startIndex:0,viewIndex:1,viewShow:!1,viewImages:[]}},computed:{fullName:function(){return this.fileName+"."+this.fileExt}},mounted:function(){},methods:{load:function(){this.init(),window.addEventListener("scroll",this.lazyLoad);var i=document.getElementById("file-preview");i&&i.addEventListener("scroll",this.lazyLoad)},init:function(){var i=this;if("txt"===this.fileExt)this.$mainHttp.common.viewTxt({mid:this.fileId}).then(function(t){t.Result?i.txtContent=t.Data:i.txtContent="加载失败"}).catch(function(){i.txtContent="加载异常"});else if(-1===this.canOpenFileExt.findIndex(function(t){return t===i.fileExt})){this.active=0,this.viewImages=[];for(var t=0;t<this.fileTotal;t++)this.viewImages.push("");this.$nextTick(function(){i.lazyLoad()})}},lazyLoad:function(){var i=this;this.fileTotal<1||this.canOpenFileExt.indexOf(this.fileExt)>-1||(this.scrollPage(),this.allFinished||setTimeout(function(){i.loadImage(i.loadIndex)},200))},scrollPage:function(){var i=[];document.querySelectorAll(".lazy").forEach(function(t){i.push(t.offsetTop)});for(var t=document.documentElement.scrollTop||document.body.scrollTop,e=document.getElementById("file-preview").scrollTop,a=0,s=0;s<i.length;s++)if(t>=i[s]&&t>0)a=s+1;else{if(!(e>=i[s]&&e>0))break;a=s+1}this.active=a>=this.fileTotal?this.fileTotal:a+1},loadImage:function(i){if(!(i>this.fileTotal)){var t=this.$refs["img"+i][0]||this.$refs["img"+i];if(t&&this.canLoad&&!t.isLoad){var e=window.innerHeight,a=document.documentElement.scrollTop||document.body.scrollTop,s=document.getElementById("file-preview").scrollTop,n=document.querySelectorAll(".lazy"),o=n.length>0?n[n.length-1].offsetTop:0,r=e+a+e/2>=this.finishedHeight||e+a+e/2>=o,l=e+s+e/2>=this.finishedHeight||e+s+e/2>=o;(r||l)&&(this.viewTotal++,this.canLoad=!1,t.init(),i>=this.fileTotal&&(this.allFinished=!0))}}},handleFinish:function(i){this.loadIndex++,this.canLoad=!0;var t=this.$refs["img"+i][0].$el.offsetHeight;this.finishedHeight+=t,this.viewImages.splice(i-1,1,this.$refs["img"+i][0].file),this.lazyLoad()},imageView:function(i){this.imagePreview=Object(n.a)({images:[i],showIndex:!1,onClose:function(){}})},toView:function(i){this.startIndex=i-1,this.onChange(i-1),this.viewShow=!0},onChange:function(i){var t=this.viewIndex;if(this.viewIndex=i+1,i===t){var e=this.viewIndex+1;if(!this.viewImages[e]&&e<=this.fileTotal){var a=this.$refs["img"+e][0]||this.$refs["img"+e];this.viewTotal++,this.canLoad=!1,a.init(),i>=this.fileTotal&&(this.allFinished=!0)}}}},watch:{fileTotal:{immediate:!0,handler:function(){this.load()}}},beforeDestroy:function(){window.removeEventListener("scroll",this.lazyLoad);var i=document.getElementById("file-preview");i&&i.removeEventListener("scroll",this.lazyLoad),this.imagePreview&&this.imagePreview.close()}},y={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{ref:"main",staticClass:"file-preview",attrs:{id:"file-preview"},on:{scroll:i.lazyLoad}},[e("div",{ref:"head",staticClass:"head-sticky"},["txt"!==i.fileExt&&"mp4"!==i.fileExt?e("span",[i._v(i._s(i.fileTotal)+"-"+i._s(i.active))]):i._e()]),i._v(" "),e("div",{staticClass:"file-main"},["txt"===i.fileExt?e("div",{staticClass:"file-txt"},[e("h2",[i._v(i._s(i.fullName))]),i._v(" "),e("p",[i._v("\n        "+i._s(i.txtContent)+"\n      ")])]):i.canOpenFileExt.indexOf(i.fileExt)>-1?e("div",{ref:"content"},[e("image-view",{attrs:{"file-id":i.fileId,"file-ext":i.fileExt,"file-total":1,index:1,"auto-load":""},on:{preview:i.imageView}}),i._v(" "),e("h2",[i._v(i._s(i.fullName))])],1):e("div",{ref:"content"},[e("h2",[i._v(i._s(i.fullName))]),i._v(" "),i._l(i.viewTotal,function(t){return e("image-view",{key:t,ref:"img"+t,refInFor:!0,staticClass:"lazy",attrs:{"file-id":i.fileId,"file-ext":i.fileExt,"file-total":i.fileTotal,index:t},on:{finish:i.handleFinish,preview:function(e){return i.toView(t)}}})}),i._v(" "),e("van-image-preview",{attrs:{"start-position":i.startIndex,images:i.viewImages,loop:!1},on:{change:i.onChange},scopedSlots:i._u([{key:"index",fn:function(){return[i._v("第"+i._s(i.viewIndex)+"页，共"+i._s(i.fileTotal)+"页")]},proxy:!0}]),model:{value:i.viewShow,callback:function(t){i.viewShow=t},expression:"viewShow"}})],2)])])},staticRenderFns:[]};var w={name:"r-file-preview",components:{RFileView:e("VU/8")(M,y,!1,function(i){e("xbE9")},"data-v-27c7c88a",null).exports},props:{fileName:{type:String,required:!0},fileExt:{type:String,default:""},fileId:{type:String,default:""}},data:function(){return{canOpenFileExt:["txt","bmp","gif","jpg","png","ico"],fileTotal:1}},mounted:function(){this.init()},methods:{init:function(){var i=this;this.canOpenFileExt.find(function(t){return t===i.fileExt})||this.$mainHttp.material.fileConvertCount({mid:this.fileId}).then(function(t){t.Result?i.fileTotal=t.Total:t.Info?(i.$toast(t.Info),i.fileTotal=0):i.fileTotal=0}).catch(function(){i.fileTotal=0})}}},T={render:function(){var i=this.$createElement,t=this._self._c||i;return t("div",{staticClass:"file-view"},[t("r-file-view",{attrs:{"file-id":this.fileId,"file-name":this.fileName,"file-ext":this.fileExt,"file-total":this.fileTotal}})],1)},staticRenderFns:[]};var E=e("VU/8")(w,T,!1,function(i){e("A1eh")},"data-v-e1a9468a",null);t.a=E.exports},wxj2:function(i,t){i.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTY4MjgyNzYyOTM3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjU4MjMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMzgzLjc1IDg1Ny42NTFIMjIzLjgzYy0zMS43MTggMC01Ny41MTgtMjUuOC01Ny41MTgtNTcuNTEzVjYzOC43YTI2LjEyNyAyNi4xMjcgMCAwIDEgNTIuMjU1IDB2MTYxLjQzOGE1LjI3NCA1LjI3NCAwIDAgMCA1LjI2OCA1LjI2NGgxNTkuOTE4YTI2LjEyNyAyNi4xMjcgMCAxIDEtMC4wMDUgNTIuMjV6IG0tMTkxLjMxNS00NDkuNTRhMjYuMTI3IDI2LjEyNyAwIDAgMS0yNi4xMjctMjYuMTI4VjIyMy41MDhjMC0zMS43MTggMjUuODA1LTU3LjUxOCA1Ny41MTgtNTcuNTE4aDE1OS45MThhMjYuMTI3IDI2LjEyNyAwIDAgMSAwIDUyLjI1NUgyMjMuODMxYTUuMjc0IDUuMjc0IDAgMCAwLTUuMjY4IDUuMjY5djE1OC40NzlhMjYuMTI3IDI2LjEyNyAwIDAgMS0yNi4xMjggMjYuMTE3ek04MDAuNDQgODU3LjY1SDY0MS45MWEyNi4xMjcgMjYuMTI3IDAgMSAxIDAtNTIuMjU1aDE1OC41M2E1LjI2OCA1LjI2OCAwIDAgMCA1LjI2NC01LjI2M1Y2MzguNjk0YTI2LjEyNyAyNi4xMjcgMCAxIDEgNTIuMjU0IDB2MTYxLjQ0YzAgMzEuNzE4LTI1LjggNTcuNTE3LTU3LjUxOCA1Ny41MTd6IG0zMS4zOTEtNDQ5LjU0YTI2LjEyNyAyNi4xMjcgMCAwIDEtMjYuMTI3LTI2LjEyOFYyMjMuNTA4YTUuMjc0IDUuMjc0IDAgMCAwLTUuMjY0LTUuMjY4SDY0MS45MWEyNi4xMjcgMjYuMTI3IDAgMCAxIDAtNTIuMjU1aDE1OC41M2MzMS43MTQgMCA1Ny41MTMgMjUuODA1IDU3LjUxMyA1Ny41MTh2MTU4LjQ4YTI2LjEyMiAyNi4xMjIgMCAwIDEtMjYuMTIyIDI2LjEyN3oiIGZpbGw9IiNmZmYiIHAtaWQ9IjU4MjQiPjwvcGF0aD48L3N2Zz4="},xbE9:function(i,t){}});
//# sourceMappingURL=2.e7454e4613d862460bf9.js.map