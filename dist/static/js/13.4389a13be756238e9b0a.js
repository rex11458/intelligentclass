webpackJsonp([13],{"1pvJ":function(t,e,s){"use strict";var a=s("j/ZV"),i={name:"task-list",props:{dataList:{type:Array,default:function(){return[]}},state:{type:String,default:"0"}},data:function(){return{dataSelected:null,operateVisible:!1}},methods:{selectItem:function(t){this.dataSelected=t,1===t.Type?this.operateVisible=!0:"0"===this.state?this.handleDeal():this.handleView()},handleDownload:function(){var t=this,e=this.dataSelected,s=this.$mainHttp.resourse.file(e.MaterialID);window.webkit?Object(a.b)(a.a.downloadFile,s).then(function(s){"0"===t.state&&t.addCoursewareTask(e)}).catch(function(t){}):(window.location.href=s,"0"===this.state&&this.addCoursewareTask(e))},addCoursewareTask:function(t){var e=this;this.$mainHttp.courseware.postCoursewareTask({cID:t.CID,stuID:this.$store.getters.studentID}).then(function(t){t.Result&&(e.$emit("refresh"),e.$toast("数据下载成功！"),e.operateVisible=!1)}).catch(function(t){})},handleFileView:function(){var t=this.dataSelected,e=t.Title.split(".");if(e.length>=2){var s=2===e.length?e[0]:e.filter(function(t,s){return s<e.length-2}).join(".");this.$router.push("/fileView/"+t.MaterialID+"/"+e[e.length-1]+"/"+s)}},handleDeal:function(){var t=this.dataSelected;this.$router.push("/space/practiceDone/"+t.CIPID+"/"+t.PLID+"/"+t.CPID+"/"+t.CHID)},handleView:function(){var t=this.dataSelected;this.$router.push("/space/practiceView/"+t.CIPID+"/"+t.PLID+"/"+t.CPID+"/"+t.CHID)}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"r-task-list"},[t._l(t.dataList,function(e,a){return s("div",{key:a,staticClass:"r-task-item",on:{click:function(s){return t.selectItem(e)}}},[s("div",{staticClass:"item-title"},[s("h3",[t._v(" "+t._s(e.Title)+" ")])]),t._v(" "),s("div",{staticClass:"item-foot foot-remark"},[s("span",[t._v("\n        "+t._s(e.Attribute+""=="1"?"课前":"课后")+"\n      ")]),t._v(" "),s("span",[t._v("\n        "+t._s(1===e.Type?"课件":"随堂练习")+"\n      ")]),t._v(" "),s("span",[t._v("\n        "+t._s(e.CreateTime.split(" ")[0])+"\n      ")])]),t._v(" "),s("div",{staticClass:"item-foot foot-info"},[s("span",[t._v("\n        "+t._s(e.CHName)+"\n      ")]),t._v(" "),s("span",[t._v("\n        老师："+t._s(e.TeacherName)+"\n      ")])])])}),t._v(" "),s("van-popup",{style:{textAlign:"center"},attrs:{position:"bottom"},model:{value:t.operateVisible,callback:function(e){t.operateVisible=e},expression:"operateVisible"}},[t.dataSelected?s("div",[s("van-cell",{attrs:{title:"预览"},on:{click:t.handleFileView}}),t._v(" "),s("van-cell",{attrs:{title:"下载"},on:{click:t.handleDownload}})],1):t._e()])],2)},staticRenderFns:[]},o=s("VU/8")(i,n,!1,null,null,null).exports;e.a=o},"8Ypc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Xxa5"),i=s.n(a),n=s("exGp"),o=s.n(n),c={name:"homework",components:{TaskList:s("1pvJ").a},data:function(){return{searchForm:{type:0,state:0,subjectID:"",classHourID:""},taskInfo:{pno:0,pageSize:8,list:[],total:0,loading:!1,error:!1,finished:!1},isLoading:!1}},mounted:function(){},methods:{search:function(t){this.searchForm.type=t.type,this.searchForm.state=t.state,this.searchForm.subjectID=t.subjectID,this.searchForm.classHourID=t.classHourID,this.init()},init:function(){this.taskInfo={pno:0,pageSize:8,list:[],total:0,loading:!1,error:!1,finished:!1},this.loadData()},loadData:function(){0===this.searchForm.state?this.getUnFinishTaskList():this.getFinishedTaskList()},getUnFinishTaskList:function(){var t=this,e=this.taskInfo;if(this.isLoading=!0,e.loading=!0,!(0===e.pno||e.total>e.pno*e.pageSize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.pno++,1===e.pno&&(e.list=[]);var s={courseID:this.searchForm.subjectID,chID:this.searchForm.classHourID,pno:e.pno,psize:e.pageSize,estate:1,stuID:this.$store.getters.studentID};(0===this.searchForm.type?this.$mainHttp.classHour.getPracticeTaskList:this.$mainHttp.classHour.getCourseWareTaskList)(s).then(function(s){s.Result&&(e.total=s.rowsCount,s.Datas&&s.Datas.length>0&&s.Datas.forEach(function(t){e.list.push(t)})),s.RowsCount&&(e.total=s.RowsCount),e.total<=e.pno*e.pageSize&&(e.finished=!0),e.loading=!1,t.isLoading=!1}).catch(function(){e.error=!0,e.loading=!1,t.isLoading=!1})},getFinishedTaskList:function(){var t=this,e=this.taskInfo;if(this.isLoading=!0,e.loading=!0,!(0===e.pno||e.total>e.pno*e.pageSize))return this.isLoading=!1,e.loading=!1,void(e.finished=!0);e.pno++,1===e.pno&&(e.list=[]);var s={courseID:this.searchForm.subjectID,chID:this.searchForm.classHourID,pno:e.pno,psize:e.pageSize,estate:2,stuID:this.$store.getters.studentID};(0===this.searchForm.type?this.$mainHttp.classHour.getPracticeTaskList:this.$mainHttp.classHour.getCourseWareTaskList)(s).then(function(s){s.Result&&(e.total=s.rowsCount,s.Datas&&s.Datas.length>0&&s.Datas.forEach(function(t){e.list.push(t)})),s.RowsCount&&(e.total=s.RowsCount),e.total<=e.pno*e.pageSize&&(e.finished=!0),e.loading=!1,t.isLoading=!1}).catch(function(){e.error=!0,e.loading=!1,t.isLoading=!1})},comment:function(t){this.$router.push("/space/coursewareComment/"+t.CID+"/"+t.CourseID)}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home-work"},[s("van-pull-refresh",{staticClass:"pull_fresh",on:{refresh:t.init},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[s("van-list",{attrs:{finished:t.taskInfo.finished,"finished-text":"没有更多了","immediate-check":!1,error:t.taskInfo.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){return t.$set(t.taskInfo,"error",e)},load:function(e){return t.loadData()}},model:{value:t.taskInfo.loading,callback:function(e){t.$set(t.taskInfo,"loading",e)},expression:"taskInfo.loading"}},[t.taskInfo.list&&t.taskInfo.list.length>0?s("task-list",{attrs:{"data-list":t.taskInfo.list,state:t.searchForm.state+""},on:{refresh:t.init}}):t._e()],1)],1)],1)},staticRenderFns:[]};var l={name:"homework",components:{homeworkList:s("VU/8")(c,r,!1,function(t){s("IFTL")},"data-v-10271aed",null).exports},data:function(){return{stateIndex:0,menus:[{name:"未完成",index:0,icon:"icon-quanbuwenjian"},{name:"已完成",index:1,icon:"icon-fenlei"}],taskTypes:[{name:"随堂练习",value:0},{name:"课件",value:1}],taskTypeIndex:0,subjectList:[],subjectSelected:null,subjectSelectedName:"",subjectPicker:!1,subjectOptions:[],classHourList:[],classHourSelected:null,classHourSelectedName:"",classHourPicker:!1,isLoading:!1}},computed:{lessonName:function(){return this.classHourSelectedName||this.subjectSelectedName}},beforeRouteEnter:function(t,e,s){s(function(t){(e.path.indexOf("/fileView")>-1||e.path.indexOf("/coursewareComment")>-1)&&(t.taskTypeIndex=1)})},mounted:function(){this.getSubjectList(),this.initSearch()},methods:{handleClick:function(t){this.initSearch()},taskTypeChange:function(){this.initSearch()},getSubjectList:function(){var t=this;this.$mainHttp.course.getAllList({studentID:this.$store.getters.studentID}).then(function(e){e.Result?e.Datas.forEach(function(e){t.subjectList.push({text:e.CourseName,value:e.CourseID})}):e.Info&&t.$toast(e.Info),t.isLoading=!1}).catch(function(){t.isLoading=!1})},getClassHourList:function(t){var e=this;this.classHourList=[];var s=this.subjectOptions.findIndex(function(e){return e.subjectID===t});s>-1?this.classHourList=this.subjectOptions[s].values.slice(0,this.subjectOptions[s].values.length):(this.classHourList=[],this.isLoading=!0,this.$mainHttp.classHour.dataList({courseID:t}).then(function(s){s.Result&&s.Datas&&s.Datas.length>0&&(s.Datas.forEach(function(t){e.classHourList.push({text:""+t.CHName,value:t.CHID})}),e.subjectOptions.push({subjectID:t,values:e.classHourList.slice(0,e.classHourList.length)})),e.isLoading=!1}).catch(function(t){e.isLoading=!1}))},subjectConfirm:function(t){var e=this;return o()(i.a.mark(function s(){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e.subjectSelected=t,e.subjectSelectedName=t.text,e.subjectPicker=!1,s.next=5,e.getClassHourList(t.value);case 5:-1===e.classHourList.findIndex(function(t){return t.value===e.classHourSelected.value})&&(e.classHourSelected=null,e.classHourSelectedName=""),e.initSearch();case 8:case"end":return s.stop()}},s,e)}))()},classHourConfirm:function(t){this.classHourSelected=t,this.classHourSelectedName=t.text,this.classHourPicker=!1,this.initSearch()},initSearch:function(){this.$refs.taskList.search({type:this.taskTypeIndex,state:this.stateIndex,subjectID:this.subjectSelected?this.subjectSelected.value:"",classHourID:this.classHourSelected?this.classHourSelected.value:""})}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"home-work"}},[s("head-top",{attrs:{title:"我的任务"}}),t._v(" "),s("van-cell-group",{style:{textAlign:"left"}},[s("van-field",{attrs:{label:"任务类型：","label-width":"70px"},scopedSlots:t._u([{key:"input",fn:function(){return[s("van-radio-group",{attrs:{direction:"horizontal"},on:{change:t.taskTypeChange},model:{value:t.taskTypeIndex,callback:function(e){t.taskTypeIndex=e},expression:"taskTypeIndex"}},t._l(t.taskTypes,function(e,a){return s("van-radio",{key:a,staticStyle:{"margin-bottom":"6px"},attrs:{name:e.value}},[t._v("\n            "+t._s(e.name)+"\n          ")])}),1)]},proxy:!0}])}),t._v(" "),s("van-field",{attrs:{readonly:"",clickable:"",label:"课程选择：",value:t.subjectSelectedName,placeholder:"选择课程"},on:{click:function(e){t.subjectPicker=!0}}}),t._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:t.subjectPicker,callback:function(e){t.subjectPicker=e},expression:"subjectPicker"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:t.subjectList},on:{cancel:function(e){t.subjectPicker=!1},confirm:t.subjectConfirm}})],1),t._v(" "),t.subjectSelected?s("van-field",{attrs:{readonly:"",clickable:"",label:"课时选择：",value:t.classHourSelectedName,placeholder:"选择课时"},on:{click:function(e){t.classHourPicker=!0}}}):t._e(),t._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:t.classHourPicker,callback:function(e){t.classHourPicker=e},expression:"classHourPicker"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:t.classHourList},on:{cancel:function(e){t.classHourPicker=!1},confirm:t.classHourConfirm}})],1)],1),t._v(" "),s("homework-list",{ref:"taskList"}),t._v(" "),s("div",{staticClass:"footer"},[s("van-tabbar",{model:{value:t.stateIndex,callback:function(e){t.stateIndex=e},expression:"stateIndex"}},t._l(t.menus,function(e,a){return s("van-tabbar-item",{key:a,on:{click:function(s){return t.handleClick(e)}}},[s("i",{staticClass:" iconfont",class:e.icon,attrs:{slot:"icon"},slot:"icon"}),t._v(" "),s("span",[t._v(t._s(e.name))])])}),1)],1)],1)},staticRenderFns:[]};var h=s("VU/8")(l,u,!1,function(t){s("gduN")},"data-v-60c938a6",null);e.default=h.exports},IFTL:function(t,e){},gduN:function(t,e){}});
//# sourceMappingURL=13.4389a13be756238e9b0a.js.map